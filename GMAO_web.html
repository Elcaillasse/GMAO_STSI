<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prototype GMAO ‚Äì Mod√®le HTML</title>
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --muted:#1f2937;       /* gray-800 */
      --card:#0b1220;        /* dark card */
      --ink:#e5e7eb;         /* gray-200 */
      --ink-dim:#9ca3af;     /* gray-400 */
      --brand:#22d3ee;       /* cyan-400 */
      --accent:#a78bfa;      /* violet-400 */
      --ok:#10b981;          /* emerald */
      --warn:#f59e0b;        /* amber */
      --bad:#ef4444;         /* red */
      --shadow:0 10px 25px rgba(0,0,0,.25), 0 1px 0 rgba(255,255,255,.03) inset;
      --radius:16px;
    }
    :root[data-theme="light"]{
      --bg:#f1f5f9;
      --panel:#ffffff;
      --muted:#e2e8f0;
      --card:#f8fafc;
      --ink:#0f172a;
      --ink-dim:#475569;
      --brand:#0ea5e9;
      --accent:#6366f1;
      --ok:#059669;
      --warn:#d97706;
      --bad:#dc2626;
      --shadow:0 12px 28px rgba(15,23,42,.12), 0 1px 0 rgba(15,23,42,.04) inset;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 600px at 80% -10%,rgba(167,139,250,.15),transparent),
                          radial-gradient(900px 500px at -20% 10%,rgba(34,211,238,.12),transparent),
                          var(--bg);color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";}
    :root[data-theme="light"] body{background:radial-gradient(1200px 600px at 80% -10%,rgba(99,102,241,.14),transparent),
                                   radial-gradient(900px 500px at -20% 10%,rgba(14,165,233,.12),transparent),
                                   var(--bg);}
    a{color:inherit;text-decoration:none}
    a:focus-visible,button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible{
      outline:2px solid var(--accent);
      outline-offset:2px;
    }
    .app{display:grid;grid-template-columns:260px 1fr;grid-template-rows:64px 1fr;height:100vh;gap:16px;padding:16px}
    header{grid-column:1/3;height:64px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);backdrop-filter:blur(6px);border-radius:var(--radius);display:flex;align-items:center;justify-content:space-between;padding:0 16px;box-shadow:var(--shadow)}
    :root[data-theme="light"] header,
    :root[data-theme="light"] nav,
    :root[data-theme="light"] main{background:linear-gradient(180deg,rgba(15,23,42,.05),rgba(15,23,42,.02));border:1px solid rgba(15,23,42,.08);}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--accent));display:grid;place-items:center;box-shadow:0 6px 20px rgba(34,211,238,.3)}
    .logo svg{filter:drop-shadow(0 2px 6px rgba(0,0,0,.3))}
    .brand h1{font-size:16px;letter-spacing:.3px;margin:0;font-weight:700}
    .header-actions{display:flex;gap:8px;align-items:center}
    .btn{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:12px;color:var(--ink);display:inline-flex;gap:8px;align-items:center;cursor:pointer;box-shadow:var(--shadow)}
    .btn.primary{background:linear-gradient(180deg,rgba(34,211,238,.25),rgba(34,211,238,.08));border-color:rgba(34,211,238,.3)}
    :root[data-theme="light"] .btn{background:linear-gradient(180deg,rgba(148,163,184,.12),rgba(148,163,184,.05));border:1px solid rgba(148,163,184,.26)}
    :root[data-theme="light"] .btn.primary{background:linear-gradient(180deg,rgba(14,165,233,.22),rgba(14,165,233,.08));border-color:rgba(14,165,233,.3)}
    .btn:active{transform:translateY(1px)}

    nav{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);padding:12px;box-shadow:var(--shadow)}
    .search{display:flex;gap:8px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px}
    :root[data-theme="light"] .search{background:rgba(148,163,184,.12);border:1px solid rgba(148,163,184,.28)}
    .search input{flex:1;background:transparent;border:0;outline:0;color:var(--ink)}
    .menu{margin-top:12px;display:flex;flex-direction:column;gap:6px;}
    .menu a{padding:10px 12px;border-radius:10px;border:1px solid transparent;display:flex;gap:10px;align-items:center}
    .menu a.active, .menu a:hover{background:rgba(167,139,250,.1);border-color:rgba(167,139,250,.25)}

    main{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);overflow:auto}
    .section{display:none;}
    .section.active{display:block}

    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:14px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px}
    :root[data-theme="light"] .card{border:1px solid rgba(15,23,42,.08)}
    .card h3{margin:0;font-size:12px;color:var(--ink-dim);font-weight:600;letter-spacing:.3px;text-transform:uppercase}
    .card .value{font-size:24px;font-weight:800}
    .card-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .card-header h3{margin:0}
    .stack{display:flex;flex-direction:column;gap:16px}
    .card.backlog-card{display:flex;flex-direction:column;gap:12px}
    .card.backlog-card .table-wrapper{flex:1;min-height:440px;overflow:auto}
    .tag{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.12)}
    .tag.ok{background:rgba(16,185,129,.15);border-color:rgba(16,185,129,.35)}
    .tag.warn{background:rgba(245,158,11,.15);border-color:rgba(245,158,11,.35)}
    .tag.bad{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.35)}
    .status-badge{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;font-size:12px;font-weight:600;background:rgba(148,163,184,.12);color:var(--ink)}
    .status-badge.ok{background:rgba(16,185,129,.18);color:var(--ok)}
    .status-badge.warn{background:rgba(245,158,11,.18);color:var(--warn)}
    .status-badge.bad{background:rgba(239,68,68,.18);color:var(--bad)}
    .status-badge.info{background:rgba(14,165,233,.18);color:var(--brand)}

    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{padding:10px}
    thead th{text-align:left;font-size:12px;color:var(--ink-dim);text-transform:uppercase;letter-spacing:.4px}
    tbody tr{background:var(--panel);border:1px solid rgba(255,255,255,.06)}
    :root[data-theme="light"] tbody tr{border:1px solid rgba(15,23,42,.08)}
    tbody tr td:first-child{border-radius:12px 0 0 12px}
    tbody tr td:last-child{border-radius:0 12px 12px 0}
    .status{font-weight:700}
    .status.ok{color:var(--ok)}
    .status.warn{color:var(--warn)}
    .status.bad{color:var(--bad)}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:12px 0}
    .toolbar .input, .toolbar select{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:8px 10px;color:var(--ink)}
    :root[data-theme="light"] .toolbar .input,
    :root[data-theme="light"] .toolbar select{background:rgba(148,163,184,.12);border:1px solid rgba(148,163,184,.28)}
    select option{background:var(--panel);color:var(--ink)}
    :root[data-theme="light"] select option{background:rgba(226,232,240,.95);color:var(--ink)}

    /* Parc machines */
    .parc-summary{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin-bottom:8px}
    .parc-kpi{gap:10px}
    .parc-kpi .parc-kpi-value{font-size:28px;font-weight:800}
    .parc-kpi .parc-kpi-meta{margin:0;color:var(--ink-dim);font-size:12px}
    .parc-toolbar{justify-content:space-between}
    .parc-toolbar .toolbar-group{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .parc-layout{display:grid;grid-template-columns:320px minmax(0,1fr);gap:16px;align-items:start;margin-top:16px}
    .machine-directory{display:flex;flex-direction:column;gap:12px}
    .machine-directory .card-header{margin-bottom:4px}
    .machine-directory-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px}
    .machine-tile{width:100%;display:flex;justify-content:space-between;align-items:flex-start;gap:12px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);color:inherit;text-align:left;cursor:pointer;transition:.2s ease;border-left:3px solid transparent;font:inherit}
    .machine-tile:hover,.machine-tile:focus-visible{border-color:rgba(167,139,250,.35);box-shadow:0 0 0 2px rgba(167,139,250,.15)}
    .machine-tile[data-status="ok"]{border-left-color:var(--ok)}
    .machine-tile[data-status="warn"]{border-left-color:var(--warn)}
    .machine-tile[data-status="bad"]{border-left-color:var(--bad)}
    .machine-tile.active{border-color:rgba(34,211,238,.45);box-shadow:0 0 0 2px rgba(34,211,238,.18);background:rgba(34,211,238,.08)}
    .machine-name{font-weight:600}
    .machine-code{font-size:11px;color:var(--ink-dim);letter-spacing:.3px;text-transform:uppercase;margin-top:2px}
    .machine-meta{margin-top:8px;display:grid;gap:4px;font-size:12px;color:var(--ink-dim)}
    .machine-meta div{display:flex;gap:6px;align-items:baseline;flex-wrap:wrap}
    .machine-meta .label{font-size:11px;text-transform:uppercase;letter-spacing:.3px;color:var(--ink-dim)}
    .machine-meta .value{color:var(--ink);font-weight:600}
    .parc-detail{display:flex;flex-direction:column;gap:16px}
    .parc-detail header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
    .parc-detail-code{font-size:12px;color:var(--ink-dim);letter-spacing:.4px;text-transform:uppercase}
    .parc-detail-name{margin:0;font-size:20px}
    .parc-detail-meta{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
    .parc-metric{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:6px}
    .parc-metric-label{font-size:12px;color:var(--ink-dim);text-transform:uppercase;letter-spacing:.3px}
    .parc-metric-value{font-weight:700}
    .parc-progress{position:relative;height:6px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
    .parc-progress span{position:absolute;inset:0;border-radius:inherit;background:linear-gradient(90deg,var(--brand),var(--accent))}
    .detail-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
    .detail-grid dl{margin:0;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:6px}
    .detail-grid dt{font-size:12px;color:var(--ink-dim);text-transform:uppercase;letter-spacing:.3px}
    .detail-grid dd{margin:0;font-weight:600}
    .parc-timeline,.parc-todo{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px}
    .parc-timeline li,.parc-todo li{display:flex;gap:12px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03)}
    .parc-timeline time{font-size:12px;color:var(--ink-dim);min-width:80px;display:inline-flex;align-items:center;font-variant-numeric:tabular-nums}
    .peripherals-list{list-style:none;margin:8px 0 0;padding:0;display:flex;flex-wrap:wrap;gap:8px}
    .peripherals-list .chip{background:rgba(255,255,255,.06)}
    :root[data-theme="light"] .peripherals-list .chip{background:rgba(148,163,184,.18)}
    .peripheral-empty{font-size:12px;color:var(--ink-dim)}
    .parc-note{font-size:13px;color:var(--ink-dim);margin:0}
    .table-card{margin-top:16px}
    tbody tr.selected{outline:2px solid var(--accent);outline-offset:-4px}
    tbody tr:focus-visible{outline:2px solid var(--accent);outline-offset:-4px}
    @media (max-width:1100px){
      .parc-summary{grid-template-columns:repeat(2,minmax(0,1fr))}
      .parc-layout{grid-template-columns:1fr}
    }

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);padding:24px}
    .modal.open{display:flex}
    .modal .sheet{width:min(720px,100%);background:var(--panel);border:1px solid rgba(255,255,255,.1);border-radius:18px;box-shadow:var(--shadow)}
    :root[data-theme="light"] .modal .sheet{border:1px solid rgba(15,23,42,.12)}
    .modal header{grid-column:auto;background:transparent;border:0;box-shadow:none;padding:16px}
    .modal .content{padding:16px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:12px;color:var(--ink-dim)}
    .field input,.field select,.field textarea{background:rgba(15,23,42,.6);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:8px 10px;color:var(--ink)}
    .field textarea{min-height:140px;resize:vertical}
    .field select option{background:var(--panel);color:var(--ink)}
    :root[data-theme="light"] .field input,
    :root[data-theme="light"] .field select,
    :root[data-theme="light"] .field textarea{background:rgba(226,232,240,.6);border:1px solid rgba(148,163,184,.4)}
    :root[data-theme="light"] .field select option{background:rgba(226,232,240,.95);color:var(--ink)}
    .actions{display:flex;gap:8px;justify-content:flex-end;padding:0 16px 16px}

    /* chips */
    .chip{border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);padding:6px 10px;border-radius:999px;font-size:12px;display:inline-flex;align-items:center;gap:6px}
    :root[data-theme="light"] .chip{border:1px solid rgba(148,163,184,.4);background:rgba(226,232,240,.6)}

    /* Bloc sites du tableau de bord */
    .sites-card{margin-bottom:16px}
    .site-panels{display:flex;gap:16px;flex-wrap:wrap;align-items:stretch}
    .site-panel{flex:1 1 320px;background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:18px;min-width:280px}
    :root[data-theme="light"] .site-panel{border:1px solid rgba(15,23,42,.08)}
    .site-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .site-title{font-size:16px;font-weight:700;letter-spacing:.4px;text-transform:uppercase}
    .site-badge{padding:4px 10px;border-radius:999px;background:rgba(167,139,250,.12);border:1px solid rgba(167,139,250,.28);font-size:12px}
    .site-section{display:flex;flex-direction:column;gap:12px}
    .site-section h4{margin:0;font-size:12px;color:var(--ink-dim);letter-spacing:.3px;text-transform:uppercase}
    .availability-summary{display:flex;align-items:center;gap:18px;flex-wrap:wrap}
    .availability-value{font-size:42px;font-weight:800;line-height:1}
    .availability-meta{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--ink-dim)}
    .trend-up{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;background:rgba(16,185,129,.15);color:var(--ok);font-size:14px;font-weight:700}
    .legend-list{list-style:none;margin:0;padding:0;display:grid;gap:10px}
    .legend-list li{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:8px 12px;gap:12px}
    :root[data-theme="light"] .legend-list li{border:1px solid rgba(148,163,184,.18);background:rgba(148,163,184,.08)}
    .legend-item{display:flex;align-items:center;gap:10px;font-weight:600}
    .legend-count{font-variant-numeric:tabular-nums;font-weight:600}
    .dot{width:12px;height:12px;border-radius:50%;display:inline-block}
    .dot.ok{background:var(--ok)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:var(--bad)}
    .dot.info{background:var(--brand)}
    .dot.attn{background:#facc15}
    .dashboard-layout{display:grid;grid-template-columns:minmax(0,2fr) minmax(0,1fr);gap:16px;align-items:start}
    .timeline{display:flex;flex-direction:column;gap:12px}
    .timeline-item{display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:start}
    .timeline-time{font-size:12px;color:var(--ink-dim);font-variant-numeric:tabular-nums;font-weight:600;padding-top:2px}
    .timeline-content{display:flex;flex-direction:column;gap:4px}
    .timeline-title{font-weight:600;font-size:14px}
    .timeline-meta{font-size:12px;color:var(--ink-dim);display:flex;gap:10px;flex-wrap:wrap}
    .alert-list{display:flex;flex-direction:column;gap:12px}
    .alert-item{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px 12px}
    :root[data-theme="light"] .alert-item{background:rgba(148,163,184,.08);border:1px solid rgba(148,163,184,.24)}
    .alert-machine{font-weight:600;font-size:14px}
    .alert-meta{font-size:12px;color:var(--ink-dim);display:flex;gap:10px;flex-wrap:wrap;margin-top:4px}
    .progress{position:relative;height:8px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
    :root[data-theme="light"] .progress{background:rgba(148,163,184,.25)}
    .progress span{position:absolute;inset:0;border-radius:inherit;background:linear-gradient(90deg,var(--brand),var(--accent))}
    .mini-bars{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px}
    .mini-bars li{display:flex;flex-direction:column;gap:6px}
    .bar-meta{display:flex;justify-content:space-between;font-size:12px;color:var(--ink-dim)}
    .bar{height:8px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    :root[data-theme="light"] .bar{background:rgba(148,163,184,.25)}
    .bar span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--brand))}

    @media (max-width:1100px){
      .app{grid-template-columns:1fr;grid-template-rows:auto 1fr}
      nav{order:2}
      main{order:3}
      header{order:1}
      .kpis{grid-template-columns:repeat(2,1fr)}
      .grid{grid-template-columns:1fr}
      .dashboard-layout{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2l3 6 6 .75-4.5 4 1.2 6.25L12 16.5 6.3 19l1.2-6.25L3 8.75 9 8l3-6z" stroke="#0b1020" stroke-width="1.2" fill="white" opacity=".9"/>
          </svg>
        </div>
        <h1>GMAO STSI / GILLET</h1>
      </div>
      <div class="header-actions">
        <button class="btn" id="themeToggle" type="button" onclick="toggleTheme()" title="Basculer le th√®me" aria-pressed="false">üåô Mode sombre</button>
        <button class="btn primary" onclick="openModal('diModal')">‚ûï Demande d‚Äôintervention</button>
      </div>
    </header>

    <nav>
      <div class="search" role="search">
        <span>üîé</span>
        <input id="globalSearch" placeholder="Rechercher‚Ä¶ (machines, OT, pi√®ces, fournisseurs)" oninput="globalFilter(this.value)">
      </div>
      <div class="menu" role="navigation">
        <a href="#" class="active" data-target="dashboard" onclick="switchSection(event)">üìä Tableau de bord</a>
        <a href="#" data-target="parc" onclick="switchSection(event)">üè≠ Parc machines</a>
        <a href="#" data-target="interventions" onclick="switchSection(event)">üõ†Ô∏è Interventions</a>
        <a href="#" data-target="preventif" onclick="switchSection(event)">‚è±Ô∏è Pr√©ventif</a>
        <a href="#" data-target="stock" onclick="switchSection(event)">üì¶ Stock & pi√®ces</a>
        <a href="#" data-target="commandes" onclick="switchSection(event)">üßæ Commandes</a>
        <a href="#" data-target="contacts" onclick="switchSection(event)">üìá Contacts</a>
        <a href="#" data-target="etiquettes" onclick="switchSection(event)">üè∑Ô∏è √âtiquettes / QR</a>
      </div>
    </nav>

    <main>
      <!-- Dashboard -->
      <section id="dashboard" class="section active" aria-label="Tableau de bord">
        <!-- Encart sites -->
        <div class="card sites-card">
          <h3>Sites suivis</h3>
          <div class="site-panels">
            <article class="site-panel">
              <div class="site-header">
                <span class="site-title">Site A</span>
                <span class="site-badge">Zone Nord</span>
              </div>
              <div class="site-section">
                <h4>Taux de Disponibilit√©</h4>
                <div class="availability-summary">
                  <span class="availability-value">50%</span>
                  <div class="availability-meta">
                    <span class="trend-up" aria-hidden="true">‚ñ≤</span>
                    <span>2 machine(s) √† l‚Äôarr√™t</span>
                  </div>
                </div>
              </div>
              <div class="site-section">
                <h4>R√©partition des Demandes d‚Äôintervention</h4>
                <ul class="legend-list" aria-label="R√©partition des demandes">
                  <li>
                    <div class="legend-item"><span class="dot bad"></span><span>Attente</span></div>
                    <span class="legend-count">6</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot info"></span><span>En cours</span></div>
                    <span class="legend-count">9</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot ok"></span><span>Termin√©</span></div>
                    <span class="legend-count">21</span>
                  </li>
                </ul>
              </div>
              <div class="site-section">
                <h4>√âtat des √âquipements</h4>
                <ul class="legend-list" aria-label="√âtat des √©quipements">
                  <li>
                    <div class="legend-item"><span class="dot ok"></span><span>Op√©rationnelles</span></div>
                    <span class="legend-count">32</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot warn"></span><span>En maintenance</span></div>
                    <span class="legend-count">5</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot bad"></span><span>√Ä l‚Äôarr√™t</span></div>
                    <span class="legend-count">2</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot attn"></span><span>Pr√©ventifs √† r√©aliser</span></div>
                    <span class="legend-count">7</span>
                  </li>
                </ul>
              </div>
            </article>
            <article class="site-panel">
              <div class="site-header">
                <span class="site-title">Site B</span>
                <span class="site-badge">Zone Sud</span>
              </div>
              <div class="site-section">
                <h4>Taux de Disponibilit√©</h4>
                <div class="availability-summary">
                  <span class="availability-value">78%</span>
                  <div class="availability-meta">
                    <span class="trend-up" aria-hidden="true">‚ñ≤</span>
                    <span>1 machine(s) √† l‚Äôarr√™t</span>
                  </div>
                </div>
              </div>
              <div class="site-section">
                <h4>R√©partition des Demandes d‚Äôintervention</h4>
                <ul class="legend-list" aria-label="R√©partition des demandes">
                  <li>
                    <div class="legend-item"><span class="dot bad"></span><span>Attente</span></div>
                    <span class="legend-count">3</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot info"></span><span>En cours</span></div>
                    <span class="legend-count">4</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot ok"></span><span>Termin√©</span></div>
                    <span class="legend-count">15</span>
                  </li>
                </ul>
              </div>
              <div class="site-section">
                <h4>√âtat des √âquipements</h4>
                <ul class="legend-list" aria-label="√âtat des √©quipements">
                  <li>
                    <div class="legend-item"><span class="dot ok"></span><span>Op√©rationnelles</span></div>
                    <span class="legend-count">18</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot warn"></span><span>En maintenance</span></div>
                    <span class="legend-count">3</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot bad"></span><span>√Ä l‚Äôarr√™t</span></div>
                    <span class="legend-count">1</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot attn"></span><span>Pr√©ventifs √† r√©aliser</span></div>
                    <span class="legend-count">2</span>
                  </li>
                </ul>
              </div>
            </article>
          </div>
        </div>

        <div class="kpis">
          <div class="card"><div class="card-header"><h3>OT Ouverts</h3><span class="tag warn">+3 cette semaine</span></div><div class="value">18</div></div>
          <div class="card"><div class="card-header"><h3>Taux pr√©ventif r√©alis√©</h3><span class="tag ok">Objectif ‚â• 80%</span></div><div class="value">86%</div></div>
        </div>

        <div class="dashboard-layout">
          <div class="stack">
            <div class="card backlog-card">
              <div class="card-header">
                <h3>Backlog par priorit√©</h3>
                <button class="btn" onclick="openModal('reportModal')">üìà Export rapide</button>
              </div>
              <div class="toolbar" style="margin:0">
                <span class="chip">P1: 4</span>
                <span class="chip">P2: 9</span>
                <span class="chip">P3: 5</span>
              </div>
              <div class="table-wrapper">
                <table aria-label="Backlog OT">
                  <thead><tr><th>OT</th><th>Machine</th><th>Type</th><th>Priorit√©</th><th>Statut</th><th>Pr√©vu</th></tr></thead>
                  <tbody id="tblBacklog">
                    <tr><td>OT-1024</td><td>DMU 70</td><td>Correctif</td><td>P1</td><td><span class="status warn">En cours</span></td><td>24/09/2025</td></tr>
                    <tr><td>OT-1025</td><td>Tornos Deco</td><td>Qualit√©</td><td>P2</td><td><span class="status ok">Planifi√©</span></td><td>26/09/2025</td></tr>
                    <tr><td>OT-1026</td><td>Compresseur KAESER</td><td>S√©curit√©</td><td>P1</td><td><span class="status bad">En retard</span></td><td>22/09/2025</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="stack">
            <div class="card">
              <div class="card-header"><h3>Pr√©ventif √† venir</h3><span class="tag">7 jours</span></div>
              <div class="mini-bars">
                <div>
                  <div class="bar-meta"><span>DMU 70 ‚Äì Contr√¥le g√©om√©trie</span><span>Due 28/09</span></div>
                  <div class="progress"><span style="width:78%"></span></div>
                </div>
                <div>
                  <div class="bar-meta"><span>Compresseur KAESER ‚Äì Filtration</span><span>Due 10/10</span></div>
                  <div class="progress"><span style="width:45%"></span></div>
                </div>
                <div>
                  <div class="bar-meta"><span>Cha√Æne convoyeur ‚Äì Graissage</span><span>Due 25/09</span></div>
                  <div class="progress"><span style="width:92%"></span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Parc -->
      <section id="parc" class="section" aria-label="Parc machines">
        <div class="parc-summary">
          <article class="card parc-kpi">
            <h3>√âquipements suivis</h3>
            <div class="parc-kpi-value" data-parc-count="total">0</div>
            <p class="parc-kpi-meta">Inventaire machines actives</p>
          </article>
          <article class="card parc-kpi">
            <h3>Disponibles</h3>
            <div class="parc-kpi-value" data-parc-count="ok">0</div>
            <p class="parc-kpi-meta">Fonctionnent sans alerte</p>
          </article>
          <article class="card parc-kpi">
            <h3>Surveillance</h3>
            <div class="parc-kpi-value" data-parc-count="warn">0</div>
            <p class="parc-kpi-meta">Alertes mineures en cours</p>
          </article>
          <article class="card parc-kpi">
            <h3>Critiques</h3>
            <div class="parc-kpi-value" data-parc-count="bad">0</div>
            <p class="parc-kpi-meta">√Ä traiter imm√©diatement</p>
          </article>
        </div>

        <div class="toolbar parc-toolbar">
          <div class="toolbar-group" role="group" aria-label="Filtres du parc">
            <input class="input" placeholder="Filtrer (zone, fabricant, machine‚Ä¶)" oninput="filterTable('tblParc', this.value, [1,2,3,4,5,6])">
            <select onchange="filterStatus('tblParc', this.value)">
              <option value="">Tous statuts</option>
              <option value="ok">OK</option>
              <option value="warn">Surveillance</option>
              <option value="bad">Critique</option>
            </select>
          </div>
          <div class="toolbar-group">
            <button class="btn" onclick="exportParc()">‚¨áÔ∏è Export rapide</button>
            <button class="btn" onclick="openModal('equipModal')">‚ûï Ajouter √©quipement</button>
          </div>
        </div>

        <div class="parc-layout">
          <aside class="card machine-directory" aria-label="S√©lection √©quipements critiques">
            <div class="card-header">
              <h3>Suivi temps r√©el</h3>
              <span class="tag warn">Priorit√© atelier</span>
            </div>
            <ul class="machine-directory-list" id="machineDirectory">
              <li>
                <button class="machine-tile" data-code="EQ-022" data-status="bad" type="button">
                  <div>
                    <div class="machine-name">Compresseur KAESER</div>
                    <div class="machine-code">EQ-022</div>
                    <div class="machine-meta">
                      <div><span class="label">Zone</span><span class="value">Utilities</span></div>
                      <div><span class="label">Fabricant</span><span class="value">KAESER</span></div>
                      <div><span class="label">Machine</span><span class="value">Compresseur √† vis</span></div>
                      <div><span class="label">Mod√®le</span><span class="value">SK 25</span></div>
                      <div><span class="label">N¬∞ s√©rie</span><span class="value">KS-25-8821</span></div>
                      <div><span class="label">Ann√©e</span><span class="value">2015</span></div>
                    </div>
                  </div>
                  <span class="status-badge bad">Arr√™t</span>
                </button>
              </li>
              <li>
                <button class="machine-tile" data-code="EQ-014" data-status="warn" type="button">
                  <div>
                    <div class="machine-name">Tornos Deco</div>
                    <div class="machine-code">EQ-014</div>
                    <div class="machine-meta">
                      <div><span class="label">Zone</span><span class="value">Tournage</span></div>
                      <div><span class="label">Fabricant</span><span class="value">Tornos</span></div>
                      <div><span class="label">Machine</span><span class="value">Tour √† d√©colletage</span></div>
                      <div><span class="label">Mod√®le</span><span class="value">Deco 13</span></div>
                      <div><span class="label">N¬∞ s√©rie</span><span class="value">DEC13-7711</span></div>
                      <div><span class="label">Ann√©e</span><span class="value">2014</span></div>
                    </div>
                  </div>
                  <span class="status-badge warn">Surveillance</span>
                </button>
              </li>
              <li>
                <button class="machine-tile" data-code="EQ-031" data-status="warn" type="button">
                  <div>
                    <div class="machine-name">Presse Hydraulique PH-200</div>
                    <div class="machine-code">EQ-031</div>
                    <div class="machine-meta">
                      <div><span class="label">Zone</span><span class="value">Assemblage</span></div>
                      <div><span class="label">Fabricant</span><span class="value">Hydropress</span></div>
                      <div><span class="label">Machine</span><span class="value">Presse hydraulique</span></div>
                      <div><span class="label">Mod√®le</span><span class="value">PH-200</span></div>
                      <div><span class="label">N¬∞ s√©rie</span><span class="value">PH200-1105</span></div>
                      <div><span class="label">Ann√©e</span><span class="value">2012</span></div>
                    </div>
                  </div>
                  <span class="status-badge warn">Planifi√©e</span>
                </button>
              </li>
              <li>
                <button class="machine-tile" data-code="EQ-001" data-status="ok" type="button">
                  <div>
                    <div class="machine-name">DMU 70</div>
                    <div class="machine-code">EQ-001</div>
                    <div class="machine-meta">
                      <div><span class="label">Zone</span><span class="value">Fraisage</span></div>
                      <div><span class="label">Fabricant</span><span class="value">DMG MORI</span></div>
                      <div><span class="label">Machine</span><span class="value">Centre d&rsquo;usinage 5 axes</span></div>
                      <div><span class="label">Mod√®le</span><span class="value">DMU 70</span></div>
                      <div><span class="label">N¬∞ s√©rie</span><span class="value">DMU70-2019-102</span></div>
                      <div><span class="label">Ann√©e</span><span class="value">2019</span></div>
                    </div>
                  </div>
                  <span class="status-badge ok">Disponible</span>
                </button>
              </li>
              <li>
                <button class="machine-tile" data-code="EQ-045" data-status="ok" type="button">
                  <div>
                    <div class="machine-name">Laser Trumpf TruLaser</div>
                    <div class="machine-code">EQ-045</div>
                    <div class="machine-meta">
                      <div><span class="label">Zone</span><span class="value">D√©coupe</span></div>
                      <div><span class="label">Fabricant</span><span class="value">TRUMPF</span></div>
                      <div><span class="label">Machine</span><span class="value">Laser fibre</span></div>
                      <div><span class="label">Mod√®le</span><span class="value">TruLaser 3030</span></div>
                      <div><span class="label">N¬∞ s√©rie</span><span class="value">TL3030-5521</span></div>
                      <div><span class="label">Ann√©e</span><span class="value">2020</span></div>
                    </div>
                  </div>
                  <span class="status-badge ok">En service</span>
                </button>
              </li>
            </ul>
          </aside>

          <article class="card parc-detail" id="parcDetail" aria-live="polite">
            <header>
              <div>
                <span class="parc-detail-code" data-field="code">S√©lection</span>
                <h3 class="parc-detail-name" data-field="name">Choisir un √©quipement</h3>
              </div>
              <span class="status-badge info" data-field="status">En attente</span>
            </header>
            <div class="parc-detail-meta">
              <div class="parc-metric">
                <span class="parc-metric-label">Disponibilit√© 30j</span>
                <div class="parc-progress"><span data-field="availability-bar" style="width:0%"></span></div>
                <span class="parc-metric-value" data-field="availability">--</span>
              </div>
              <div class="parc-metric">
                <span class="parc-metric-label">Heures depuis maintenance</span>
                <span class="parc-metric-value" data-field="hours">--</span>
              </div>
            </div>
            <div class="detail-grid">
              <dl><dt>Zone</dt><dd data-field="zone">-</dd></dl>
              <dl><dt>Fabricant</dt><dd data-field="fabricant">-</dd></dl>
              <dl><dt>Machine</dt><dd data-field="machine">-</dd></dl>
              <dl><dt>Mod√®le</dt><dd data-field="modele">-</dd></dl>
              <dl><dt>N¬∞ s√©rie</dt><dd data-field="numeroSerie">-</dd></dl>
              <dl><dt>Ann√©e</dt><dd data-field="annee">-</dd></dl>
              <dl><dt>Sous-ensemble</dt><dd data-field="subset">-</dd></dl>
              <dl><dt>Criticit√©</dt><dd data-field="criticite">-</dd></dl>
              <dl><dt>Derni√®re intervention</dt><dd data-field="last">-</dd></dl>
            </div>
            <div>
              <h4>P√©riph√©riques associ√©s</h4>
              <ul class="peripherals-list" data-field="peripheriques">
                <li class="peripheral-empty">Aucun p√©riph√©rique renseign√©</li>
              </ul>
            </div>
            <div>
              <h4>Interventions r√©centes</h4>
              <ul class="parc-timeline" data-field="history"><li><time>‚Äî</time><div>Aucune donn√©e</div></li></ul>
            </div>
            <div>
              <h4>Actions planifi√©es</h4>
              <ul class="parc-todo" data-field="upcoming"><li><time>‚Äî</time><div>Planifier une action</div></li></ul>
            </div>
            <p class="parc-note" data-field="notes">S√©lectionnez une machine pour afficher les d√©tails contextuels, les maintenances √† venir et les consignes.</p>
          </article>
        </div>

        <div class="card table-card">
          <div class="card-header"><h3>Inventaire du parc</h3><span class="tag">Vue tableau</span></div>
          <div class="table-wrapper">
            <table aria-label="Parc">
              <thead><tr><th>Code</th><th>Zone</th><th>Fabricant</th><th>Machine</th><th>Mod√®le</th><th>N¬∞ S√©rie</th><th>Ann√©e</th><th>Statut</th></tr></thead>
              <tbody id="tblParc">
                <tr data-code="EQ-022" data-status="bad" tabindex="0"><td>EQ-022</td><td>Utilities</td><td>KAESER</td><td>Compresseur √† vis</td><td>SK 25</td><td>KS-25-8821</td><td>2015</td><td><span class="status bad">Critique</span></td></tr>
                <tr data-code="EQ-014" data-status="warn" tabindex="0"><td>EQ-014</td><td>Tournage</td><td>Tornos</td><td>Tour √† d√©colletage</td><td>Deco 13</td><td>DEC13-7711</td><td>2014</td><td><span class="status warn">Surveillance</span></td></tr>
                <tr data-code="EQ-031" data-status="warn" tabindex="0"><td>EQ-031</td><td>Assemblage</td><td>Hydropress</td><td>Presse hydraulique</td><td>PH-200</td><td>PH200-1105</td><td>2012</td><td><span class="status warn">Planifi√©e</span></td></tr>
                <tr data-code="EQ-001" data-status="ok" tabindex="0"><td>EQ-001</td><td>Fraisage</td><td>DMG MORI</td><td>Centre d&rsquo;usinage 5 axes</td><td>DMU 70</td><td>DMU70-2019-102</td><td>2019</td><td><span class="status ok">Disponible</span></td></tr>
                <tr data-code="EQ-045" data-status="ok" tabindex="0"><td>EQ-045</td><td>D√©coupe</td><td>TRUMPF</td><td>Laser fibre</td><td>TruLaser 3030</td><td>TL3030-5521</td><td>2020</td><td><span class="status ok">En service</span></td></tr>
                <tr data-code="EQ-055" data-status="ok" tabindex="0"><td>EQ-055</td><td>Peinture</td><td>Gema</td><td>Cabine de poudrage</td><td>MagicCompact EquiFlow</td><td>GEQ-3321</td><td>2017</td><td><span class="status ok">Disponible</span></td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Interventions -->
      <section id="interventions" class="section" aria-label="Interventions">
        <div class="toolbar">
          <select id="selType" class="input" onchange="filterTable('tblOT', this.value, [2])">
            <option value="">Type: Tous</option>
            <option>Correctif</option>
            <option>Palliatif</option>
            <option>Qualit√©</option>
            <option>S√©curit√©</option>
          </select>
          <select id="selPrio" class="input" onchange="filterTable('tblOT', this.value, [3])">
            <option value="">Priorit√©: Toutes</option>
            <option>P1</option>
            <option>P2</option>
            <option>P3</option>
          </select>
          <input class="input" placeholder="Rechercher travaux‚Ä¶" oninput="filterTable('tblOT', this.value, [5])">
          <button class="btn" onclick="openModal('otModal')">‚ûï Nouvel OT</button>
        </div>
        <table aria-label="Interventions">
          <thead><tr><th>OT</th><th>Machine</th><th>Type</th><th>Priorit√©</th><th>Statut</th><th>Travaux</th><th>Pr√©vu</th></tr></thead>
          <tbody id="tblOT">
            <tr><td>OT-1024</td><td>DMU 70</td><td>Correctif</td><td>P1</td><td><span class="status warn">En cours</span></td><td>Vibrations broche</td><td>24/09/2025</td></tr>
            <tr><td>OT-1025</td><td>Tornos Deco</td><td>Qualit√©</td><td>P2</td><td><span class="status ok">Planifi√©</span></td><td>Contr√¥le g√©om√©trie</td><td>26/09/2025</td></tr>
            <tr><td>OT-1026</td><td>Compresseur KAESER</td><td>S√©curit√©</td><td>P1</td><td><span class="status bad">En retard</span></td><td>Remplacer cartouche</td><td>22/09/2025</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Pr√©ventif -->
      <section id="preventif" class="section" aria-label="Pr√©ventif">
        <div class="toolbar">
          <select class="input" onchange="filterTable('tblPrev', this.value, [2])">
            <option value="">P√©riodicit√©</option>
            <option>Hebdo</option>
            <option>Mensuel</option>
            <option>Trimestriel</option>
          </select>
          <button class="btn" onclick="openModal('planModal')">‚öôÔ∏è G√©n√©rer OT pr√©ventifs</button>
        </div>
        <table aria-label="Plan pr√©ventif">
          <thead><tr><th>Plan</th><th>Machine</th><th>P√©riodicit√©</th><th>Dernier</th><th>Prochain</th><th>√âtat</th></tr></thead>
        <tbody id="tblPrev">
          <tr><td>PV-001</td><td>DMU 70</td><td>Mensuel</td><td>28/08/2025</td><td>28/09/2025</td><td><span class="status ok">√Ä l'heure</span></td></tr>
          <tr><td>PV-017</td><td>Tornos Deco</td><td>Hebdo</td><td>18/09/2025</td><td>25/09/2025</td><td><span class="status warn">√Ä lancer</span></td></tr>
          <tr><td>PV-023</td><td>Compresseur KAESER</td><td>Trimestriel</td><td>10/07/2025</td><td>10/10/2025</td><td><span class="status ok">OK</span></td></tr>
        </tbody>
        </table>
      </section>

      <!-- Stock -->
      <section id="stock" class="section" aria-label="Stock & pi√®ces">
        <div class="toolbar">
          <input class="input" placeholder="Rechercher une pi√®ce‚Ä¶" oninput="filterTable('tblStock', this.value, [1,2,3])">
          <select class="input" onchange="filterStockAlerte(this.value)">
            <option value="">Alerte stock</option>
            <option value="seuil">Sous seuil</option>
            <option value="ok">OK</option>
          </select>
          <button class="btn" onclick="openModal('pieceModal')">‚ûï Nouvelle pi√®ce</button>
        </div>
        <table aria-label="Stock">
          <thead><tr><th>R√©f interne</th><th>D√©signation</th><th>Code</th><th>Emplacement</th><th>Qt√©</th><th>Seuil</th><th>Co√ªt (‚Ç¨)</th></tr></thead>
          <tbody id="tblStock">
            <tr data-qty="3" data-seuil="5"><td>PI-0001</td><td>Cartouche filtre</td><td>CF-45</td><td>Mag A1</td><td>3</td><td>5</td><td>48.50</td></tr>
            <tr data-qty="22" data-seuil="10"><td>PI-0040</td><td>Courroie HTD</td><td>HTD-560</td><td>Mag C3</td><td>22</td><td>10</td><td>12.20</td></tr>
            <tr data-qty="6" data-seuil="6"><td>PI-0099</td><td>Graisse SKF</td><td>SKF-G1</td><td>Atelier</td><td>6</td><td>6</td><td>9.80</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Commandes -->
      <section id="commandes" class="section" aria-label="Commandes">
        <div class="toolbar">
          <select class="input" onchange="filterTable('tblCmd', this.value, [5])">
            <option value="">Statut</option>
            <option>Demand√©e</option>
            <option>Command√©e</option>
            <option>R√©ceptionn√©e</option>
          </select>
          <button class="btn" onclick="openModal('cmdModal')">‚ûï Nouvelle commande</button>
        </div>
        <table aria-label="Commandes">
          <thead><tr><th>N¬∞</th><th>R√©f interne</th><th>Code</th><th>D√©signation</th><th>Fournisseur</th><th>Statut</th><th>Montant (‚Ç¨)</th></tr></thead>
          <tbody id="tblCmd">
            <tr><td>CMD-2309-01</td><td>PI-0001</td><td>CF-45</td><td>Cartouche filtre</td><td>AirTech</td><td>Command√©e</td><td>145.50</td></tr>
            <tr><td>CMP-2309-15</td><td>PI-0040</td><td>HTD-560</td><td>Courroie HTD</td><td>MecaPro</td><td>Demand√©e</td><td>85.00</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Contacts -->
      <section id="contacts" class="section" aria-label="Contacts">
        <div class="toolbar">
          <input class="input" placeholder="Rechercher fournisseur/intervenant‚Ä¶" oninput="filterTable('tblContacts', this.value, [0,1,2,3])">
          <button class="btn" onclick="openModal('contactModal')">‚ûï Nouveau contact</button>
        </div>
        <table aria-label="Contacts">
          <thead><tr><th>Entreprise</th><th>Activit√©</th><th>Contact</th><th>Email</th><th>T√©l√©phone</th></tr></thead>
          <tbody id="tblContacts">
            <tr><td>AirTech</td><td>Compresseurs</td><td>J. Martin</td><td>service@airtech.tld</td><td>+33 4 12 34 56 78</td></tr>
            <tr><td>MecaPro</td><td>Fourniture M√©canique</td><td>S. Leroy</td><td>contact@mecapro.tld</td><td>+33 1 98 76 54 32</td></tr>
          </tbody>
        </table>
      </section>

      <!-- √âtiquettes -->
      <section id="etiquettes" class="section" aria-label="√âtiquettes">
        <div class="toolbar">
          <input class="input" placeholder="Code / R√©f‚Ä¶" oninput="renderLabels(this.value)">
          <button class="btn" onclick="window.print()">üñ®Ô∏è Imprimer</button>
        </div>
        <div id="labels" class="grid"></div>
      </section>
    </main>
  </div>

  <!-- Modals -->
  <div class="modal" id="otModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Cr√©er un OT">
    <div class="sheet">
      <header>
        <div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Nouvel ordre de travail</h1></div>
      </header>
      <div class="content">
        <div class="grid">
          <div class="field"><label>Machine</label><input placeholder="ex. DMU 70"/></div>
          <div class="field"><label>Type</label><select><option>Correctif</option><option>Palliatif</option><option>Qualit√©</option><option>S√©curit√©</option></select></div>
          <div class="field"><label>Priorit√©</label><select><option>P1</option><option>P2</option><option>P3</option></select></div>
          <div class="field"><label>Pr√©vu le</label><input type="date"/></div>
          <div class="field" style="grid-column:1/-1"><label>Travaux √† effectuer</label><textarea rows="3" placeholder="D√©crire la demande‚Ä¶"></textarea></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" onclick="closeModal('otModal')">Annuler</button>
        <button class="btn primary" onclick="closeModal('otModal')">Cr√©er</button>
      </div>
    </div>
  </div>

  <div class="modal" id="diModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Cr√©er une demande d‚Äôintervention">
    <div class="sheet">
      <header>
        <div class="brand">
          <div class="logo" style="width:28px;height:28px"></div>
          <h1>Nouvelle demande d‚Äôintervention</h1>
        </div>
      </header>
      <div class="content">
        <div class="grid">
          <div class="field">
            <label>Date de la demande</label>
            <input type="date"/>
          </div>
          <div class="field">
            <label>Machine</label>
            <input type="text" placeholder="Nom de la machine‚Ä¶"/>
          </div>
          <div class="field">
            <label>Type</label>
            <select>
              <option value="correctif">Correctif</option>
              <option value="palliatif">Palliatif</option>
              <option value="qualite">Qualit√©</option>
              <option value="securite">S√©curit√©</option>
            </select>
          </div>
          <div class="field">
            <label>Priorit√©</label>
            <select>
              <option value="P1">P1 ‚Äî Urgent (machine √† l‚Äôarr√™t)</option>
              <option value="P2">P2 ‚Äî Moyen (d√©faut sans interruption)</option>
              <option value="P3">P3 ‚Äî Faible</option>
            </select>
          </div>
          <div class="field">
            <label>Machine √† l‚Äôarr√™t</label>
            <select>
              <option value="oui">Oui</option>
              <option value="non">Non</option>
            </select>
          </div>
          <div class="field" style="grid-column:1/-1">
            <label>Travaux √† effectuer</label>
            <textarea rows="3" placeholder="D√©crire les travaux demand√©s‚Ä¶"></textarea>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" onclick="closeModal('diModal')">Annuler</button>
        <button class="btn primary" onclick="closeModal('diModal')">Envoyer</button>
      </div>
    </div>
  </div>

  <div class="modal" id="equipModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Ajouter un √©quipement">
    <div class="sheet">
      <header>
        <div class="brand">
          <div class="logo" style="width:28px;height:28px"></div>
          <h1>Ajouter √©quipement</h1>
        </div>
      </header>
      <div class="content">
        <div class="grid">
          <div class="field"><label>Code √©quipement</label><input placeholder="ex. EQ-120"></div>
          <div class="field"><label>Zone</label><input placeholder="ex. Tournage"></div>
          <div class="field"><label>Fabricant</label><input placeholder="ex. Tornos"></div>
          <div class="field"><label>Machine</label><input placeholder="ex. Tour √† d√©colletage"></div>
          <div class="field"><label>Mod√®le</label><input placeholder="ex. Deco 13"></div>
          <div class="field"><label>Num√©ro de s√©rie</label><input placeholder="ex. DEC13-7711"></div>
          <div class="field"><label>Ann√©e</label><input type="number" min="1900" max="2100" placeholder="ex. 2020"></div>
          <div class="field"><label>Criticit√©</label><select><option>Basse</option><option>Moyenne</option><option>Haute</option></select></div>
          <div class="field" style="grid-column:1/-1"><label>P√©riph√©riques associ√©s</label><textarea rows="3" placeholder="ex. Embarreur 1 (CTZ1), Chargeur barres 3 m"></textarea></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" onclick="closeModal('equipModal')">Fermer</button>
        <button class="btn primary" onclick="closeModal('equipModal')">Enregistrer</button>
      </div>
    </div>
  </div>
  <div class="modal" id="pieceModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Cr√©er une pi√®ce"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Nouvelle pi√®ce</h1></div></header><div class="content"><div class="grid"><div class="field"><label>R√©f interne</label><input></div><div class="field"><label>D√©signation</label><input></div><div class="field"><label>Code</label><input></div><div class="field"><label>Emplacement</label><input></div><div class="field"><label>Seuil</label><input type="number"></div><div class="field"><label>Co√ªt (‚Ç¨)</label><input type="number" step="0.01"></div></div></div><div class="actions"><button class="btn" onclick="closeModal('pieceModal')">Fermer</button><button class="btn primary" onclick="closeModal('pieceModal')">Enregistrer</button></div></div></div>
  <div class="modal" id="cmdModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Cr√©er une commande"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Nouvelle commande</h1></div></header><div class="content"><div class="grid"><div class="field"><label>Fournisseur</label><input></div><div class="field"><label>R√©f interne</label><input></div><div class="field"><label>Code</label><input></div><div class="field"><label>Statut</label><select><option>Demand√©e</option><option>Command√©e</option><option>R√©ceptionn√©e</option></select></div><div class="field"><label>Montant (‚Ç¨)</label><input type="number" step="0.01"></div></div></div><div class="actions"><button class="btn" onclick="closeModal('cmdModal')">Fermer</button><button class="btn primary" onclick="closeModal('cmdModal')">Enregistrer</button></div></div></div>
  <div class="modal" id="contactModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Cr√©er un contact"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Nouveau contact</h1></div></header><div class="content"><div class="grid"><div class="field"><label>Entreprise</label><input></div><div class="field"><label>Activit√©</label><input></div><div class="field"><label>Contact</label><input></div><div class="field"><label>Email</label><input type="email"></div><div class="field"><label>T√©l√©phone</label><input></div></div></div><div class="actions"><button class="btn" onclick="closeModal('contactModal')">Fermer</button><button class="btn primary" onclick="closeModal('contactModal')">Enregistrer</button></div></div></div>
  <div class="modal" id="planModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="G√©n√©rer des OT pr√©ventifs"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>G√©n√©rer OT pr√©ventifs</h1></div></header><div class="content"><p>S√©lectionner l'horizon de planification et la p√©riodicit√©.</p><div class="grid"><div class="field"><label>Horizon (jours)</label><input type="number" value="30"></div><div class="field"><label>Inclure retard</label><select><option>Oui</option><option>Non</option></select></div></div></div><div class="actions"><button class="btn" onclick="closeModal('planModal')">Fermer</button><button class="btn primary" onclick="closeModal('planModal')">G√©n√©rer</button></div></div></div>
  <div class="modal" id="reportModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Exporter les donn√©es"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Export rapide</h1></div></header><div class="content"><p>Ce prototype exportera un CSV fictif. √Ä connecter √† votre backend plus tard.</p></div><div class="actions"><button class="btn" onclick="closeModal('reportModal')">Fermer</button><button class="btn primary" onclick="fakeExport()">Exporter CSV</button></div></div></div>

  <script>
    const THEMES = {
      dark:{
        '--bg':'#0f172a',
        '--panel':'#111827',
        '--muted':'#1f2937',
        '--card':'#0b1220',
        '--ink':'#e5e7eb',
        '--ink-dim':'#9ca3af',
        '--brand':'#22d3ee',
        '--accent':'#a78bfa',
        '--ok':'#10b981',
        '--warn':'#f59e0b',
        '--bad':'#ef4444',
        '--shadow':'0 10px 25px rgba(0,0,0,.25), 0 1px 0 rgba(255,255,255,.03) inset'
      },
      light:{
        '--bg':'#f1f5f9',
        '--panel':'#ffffff',
        '--muted':'#e2e8f0',
        '--card':'#f8fafc',
        '--ink':'#0f172a',
        '--ink-dim':'#475569',
        '--brand':'#0ea5e9',
        '--accent':'#6366f1',
        '--ok':'#059669',
        '--warn':'#d97706',
        '--bad':'#dc2626',
        '--shadow':'0 12px 28px rgba(15,23,42,.12), 0 1px 0 rgba(15,23,42,.04) inset'
      }
    };
    const FOCUSABLE_SELECTOR = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
    let currentTheme = 'dark';
    let activeModal = null;
    let lastFocusedElement = null;

    function switchSection(e){
      e.preventDefault();
      const target = e.currentTarget.getAttribute('data-target');
      document.querySelectorAll('.menu a').forEach(a=>a.classList.toggle('active', a.getAttribute('data-target')===target));
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.getElementById(target).classList.add('active');
    }

    function navigateToSection(target){
      const link = document.querySelector(`.menu a[data-target="${target}"]`);
      if(link){
        link.click();
        link.focus({preventScroll:true});
      }
    }

    function applyTheme(theme,{persist=true}={}){
      if(!THEMES[theme]) theme='dark';
      currentTheme = theme;
      const root = document.documentElement;
      root.dataset.theme = theme;
      const vars = THEMES[theme];
      Object.entries(vars).forEach(([key,val])=>root.style.setProperty(key,val));
      if(persist){
        try{ localStorage.setItem('gmao-theme', theme); }catch(_e){/* storage non critique */}
      }
      updateThemeToggle();
    }

    function updateThemeToggle(){
      const btn = document.getElementById('themeToggle');
      if(!btn) return;
      const isLight = currentTheme === 'light';
      btn.setAttribute('aria-pressed', isLight ? 'true' : 'false');
      btn.textContent = isLight ? 'üåû Mode clair' : 'üåô Mode sombre';
    }

    function toggleTheme(){
      const next = currentTheme === 'dark' ? 'light' : 'dark';
      applyTheme(next);
    }

    function openModal(id){
      const modal = document.getElementById(id);
      if(!modal) return;
      lastFocusedElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      activeModal = modal;
      document.body.style.overflow = 'hidden';
      const focusable = modal.querySelectorAll(FOCUSABLE_SELECTOR);
      if(focusable.length){
        focusable[0].focus({preventScroll:true});
      }
    }

    function closeModal(id){
      const modal = document.getElementById(id);
      if(!modal) return;
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
      if(activeModal === modal) activeModal = null;
      if(!document.querySelector('.modal.open')){
        document.body.style.overflow = '';
        if(lastFocusedElement && document.body.contains(lastFocusedElement)){
          lastFocusedElement.focus({preventScroll:true});
        }
        lastFocusedElement = null;
      }
    }

    function closeActiveModal(){
      if(activeModal){
        closeModal(activeModal.id);
      }
    }

    // Simple global filter across visible table bodies
    function globalFilter(q){
      q = (q||'').toLowerCase();
      document.querySelectorAll('tbody').forEach(tb=>{
        tb.querySelectorAll('tr').forEach(tr=>{
          const hit = tr.innerText.toLowerCase().includes(q);
          tr.style.display = hit ? '' : 'none';
        });
      });
    }

    function filterTable(tbodyId, q, cols){
      q = (q||'').toLowerCase();
      const rows = document.getElementById(tbodyId).rows;
      for(const tr of rows){
        if(!q){ tr.style.display=''; continue; }
        let hit=false;
        (cols||[...tr.cells].map((_,i)=>i)).forEach(i=>{
          const cell = tr.cells[i];
          if(cell && cell.innerText.toLowerCase().includes(q)) hit=true;
        });
        tr.style.display = hit?'':'none';
      }
    }

    function filterStatus(tbodyId, status){
      const rows = document.getElementById(tbodyId).rows;
      for(const tr of rows){
        const st = (tr.getAttribute('data-status')||'').toLowerCase();
        tr.style.display = !status || st===status ? '' : 'none';
      }
    }

    function filterStockAlerte(val){
      const rows = document.getElementById('tblStock').rows;
      for(const tr of rows){
        const q = parseFloat(tr.getAttribute('data-qty'));
        const s = parseFloat(tr.getAttribute('data-seuil'));
        const sousSeuil = q < s;
        if(!val) tr.style.display='';
        else if(val==='seuil') tr.style.display = sousSeuil ? '' : 'none';
        else if(val==='ok') tr.style.display = sousSeuil ? 'none' : '';
      }
    }

    const PARC_DETAILS = {
      'EQ-022': {
        code:'EQ-022',
        name:'Compresseur KAESER',
        zone:'Utilities',
        fabricant:'KAESER',
        machine:'Compresseur √† vis',
        modele:'SK 25',
        numeroSerie:'KS-25-8821',
        annee:'2015',
        sousEnsemble:'Filtration',
        criticite:'Haute',
        status:{label:'Arr√™t', tone:'bad'},
        availability:'42%',
        availabilityBar:'42%',
        hours:'12 h',
        last:'22/09/2025 ‚Äì Cartouche satur√©e',
        notes:'Arr√™t complet suite √† d√©rive pression. Intervention s√©curit√© prioritaire avant reprise.',
        history:[
          {date:'22/09/2025', text:'Arr√™t urgence ‚Äì pression insuffisante, cartouche colmat√©e'},
          {date:'18/09/2025', text:'Contr√¥le routine filtres (alerte fine particules)'}
        ],
        upcoming:[
          {date:'24/09/2025', text:'Remplacement cartouche CF-45 et purge circuit'},
          {date:'30/09/2025', text:'Analyse huile compresseur'}
        ],
        peripheriques:['S√©cheur SEC-12','R√©servoir tampon 500 L']
      },
      'EQ-014': {
        code:'EQ-014',
        name:'Tornos Deco',
        zone:'Tournage',
        fabricant:'Tornos',
        machine:'Tour √† d√©colletage',
        modele:'Deco 13',
        numeroSerie:'DEC13-7711',
        annee:'2014',
        sousEnsemble:'Hydraulique',
        criticite:'Haute',
        status:{label:'Surveillance', tone:'warn'},
        availability:'76%',
        availabilityBar:'76%',
        hours:'46 h',
        last:'20/09/2025 ‚Äì Purge hydraulique partielle',
        notes:'Micro-fuites d√©tect√©es sur flexibles retour. Pr√©voir remplacement lors du prochain arr√™t planifi√©.',
        history:[
          {date:'20/09/2025', text:'Purge circuit hydraulique et ajout additif anti-mousse'},
          {date:'12/09/2025', text:'Diagnostic capteur pression hydraulique'}
        ],
        upcoming:[
          {date:'27/09/2025', text:'Remplacement flexible retour HP'},
          {date:'05/10/2025', text:'V√©rification capteur pression'}
        ],
        peripheriques:['Embarreur 1 (CTZ1)','Chargeur barres 3 m']
      },
      'EQ-031': {
        code:'EQ-031',
        name:'Presse Hydraulique PH-200',
        zone:'Assemblage',
        fabricant:'Hydropress',
        machine:'Presse hydraulique',
        modele:'PH-200',
        numeroSerie:'PH200-1105',
        annee:'2012',
        sousEnsemble:'Circuit huile',
        criticite:'Moyenne',
        status:{label:'Planifi√©e', tone:'warn'},
        availability:'88%',
        availabilityBar:'88%',
        hours:'72 h',
        last:'16/09/2025 ‚Äì Contr√¥le v√©rins',
        notes:'Pr√©voir arr√™t de 2 h pour remplacement kit joints lors du cr√©neau de nuit.',
        history:[
          {date:'16/09/2025', text:'Inspection v√©rins + √©tanch√©it√© OK'},
          {date:'03/09/2025', text:'Remplacement capteur fin de course'}
        ],
        upcoming:[
          {date:'26/09/2025', text:'Remplacement kit joints circuit huile'},
          {date:'15/10/2025', text:'Calibration cellule effort'}
        ],
        peripheriques:['Table de positionnement A','Armoire hydraulique d√©di√©e']
      },
      'EQ-001': {
        code:'EQ-001',
        name:'DMU 70',
        zone:'Fraisage',
        fabricant:'DMG MORI',
        machine:'Centre d‚Äôusinage 5 axes',
        modele:'DMU 70',
        numeroSerie:'DMU70-2019-102',
        annee:'2019',
        sousEnsemble:'Broche',
        criticite:'Moyenne',
        status:{label:'Disponible', tone:'ok'},
        availability:'98%',
        availabilityBar:'98%',
        hours:'124 h',
        last:'18/09/2025 ‚Äì Contr√¥le vibrations',
        notes:'Surveiller la mont√©e en temp√©rature du palier en d√©but de poste. Aucun √©cart critique relev√©.',
        history:[
          {date:'18/09/2025', text:'Contr√¥le vibrations broche ‚Äì valeurs nominales'},
          {date:'02/09/2025', text:'Vidange huile broche'}
        ],
        upcoming:[
          {date:'05/10/2025', text:'Graissage paliers automatiques'},
          {date:'20/10/2025', text:'V√©rification alignement axes'}
        ],
        peripheriques:['Magasin outils 60 postes','Table rotative RT-125']
      },
      'EQ-045': {
        code:'EQ-045',
        name:'Laser Trumpf TruLaser',
        zone:'D√©coupe',
        fabricant:'TRUMPF',
        machine:'Laser fibre',
        modele:'TruLaser 3030',
        numeroSerie:'TL3030-5521',
        annee:'2020',
        sousEnsemble:'Optiques',
        criticite:'Basse',
        status:{label:'En service', tone:'ok'},
        availability:'94%',
        availabilityBar:'94%',
        hours:'38 h',
        last:'15/09/2025 ‚Äì Nettoyage optiques',
        notes:'Surveillance du refroidissement. Pr√©voir remplacement filtre eau si delta T > 6¬∞C.',
        history:[
          {date:'15/09/2025', text:'Nettoyage optiques + recalage faisceau'},
          {date:'01/09/2025', text:'Remplacement buse d√©coupe inox'}
        ],
        upcoming:[
          {date:'29/09/2025', text:'Remplacement filtre eau refroidissement'},
          {date:'12/10/2025', text:'Contr√¥le alignement axes'}
        ],
        peripheriques:['TruStore 3030','Refroidisseur TCU 3030']
      },
      'EQ-055': {
        code:'EQ-055',
        name:'Cabine poudre',
        zone:'Peinture',
        fabricant:'Gema',
        machine:'Cabine de poudrage',
        modele:'MagicCompact EquiFlow',
        numeroSerie:'GEQ-3321',
        annee:'2017',
        sousEnsemble:'Filtration',
        criticite:'Moyenne',
        status:{label:'Disponible', tone:'ok'},
        availability:'91%',
        availabilityBar:'91%',
        hours:'58 h',
        last:'19/09/2025 ‚Äì Changement cartouches',
        notes:'V√©rifier le diff√©rentiel de pression collecteur 1 fois / semaine.',
        history:[
          {date:'19/09/2025', text:'Remplacement cartouches filtre poudre'},
          {date:'08/09/2025', text:'Contr√¥le ventilation cabine'}
        ],
        upcoming:[
          {date:'28/09/2025', text:'Nettoyage complet cabine'},
          {date:'18/10/2025', text:'Mesure a√©raulique r√©glementaire'}
        ],
        peripheriques:['Cyclone r√©cup√©ration poudre','Tunnel de cuisson int√©gr√©']
      }
    };

    function updateParcCounters(){
      const rows = Array.from(document.querySelectorAll('#tblParc tr'));
      const counters = {total:rows.length, ok:0, warn:0, bad:0};
      rows.forEach(tr=>{
        const status = tr.getAttribute('data-status');
        if(status && counters[status]!==undefined) counters[status]++;
      });
      Object.entries(counters).forEach(([key,value])=>{
        const target = document.querySelector(`[data-parc-count="${key}"]`);
        if(target) target.textContent = value;
      });
    }

    function updateParcDetail(code){
      const detail = PARC_DETAILS[code];
      const card = document.getElementById('parcDetail');
      if(!card || !detail) return;
      card.querySelector('[data-field="code"]').textContent = detail.code;
      card.querySelector('[data-field="name"]').textContent = detail.name;
      const statusEl = card.querySelector('[data-field="status"]');
      statusEl.textContent = detail.status.label;
      statusEl.className = `status-badge ${detail.status.tone}`;
      card.querySelector('[data-field="availability"]').textContent = detail.availability;
      const bar = card.querySelector('[data-field="availability-bar"]');
      if(bar) bar.style.width = detail.availabilityBar;
      card.querySelector('[data-field="hours"]').textContent = detail.hours;
      const textFields = {
        zone: detail.zone,
        fabricant: detail.fabricant,
        machine: detail.machine || detail.name,
        modele: detail.modele,
        numeroSerie: detail.numeroSerie,
        annee: detail.annee,
        subset: detail.sousEnsemble,
        criticite: detail.criticite,
        last: detail.last,
        notes: detail.notes
      };
      Object.entries(textFields).forEach(([field,value])=>{
        const target = card.querySelector(`[data-field="${field}"]`);
        if(target) target.textContent = value || '‚Äî';
      });

      const periphList = card.querySelector('[data-field="peripheriques"]');
      if(periphList){
        periphList.innerHTML = '';
        const periph = Array.isArray(detail.peripheriques) ? detail.peripheriques.filter(Boolean) : [];
        if(periph.length){
          periph.forEach(item=>{
            const li = document.createElement('li');
            li.className = 'chip';
            li.textContent = item;
            periphList.appendChild(li);
          });
        }else{
          const li = document.createElement('li');
          li.className = 'peripheral-empty';
          li.textContent = 'Aucun p√©riph√©rique renseign√©';
          periphList.appendChild(li);
        }
      }

      const historyList = card.querySelector('[data-field="history"]');
      if(historyList){
        historyList.innerHTML = '';
        detail.history.forEach(item=>{
          const li = document.createElement('li');
          const time = document.createElement('time');
          time.textContent = item.date;
          const txt = document.createElement('div');
          txt.textContent = item.text;
          li.appendChild(time);
          li.appendChild(txt);
          historyList.appendChild(li);
        });
      }

      const todoList = card.querySelector('[data-field="upcoming"]');
      if(todoList){
        todoList.innerHTML = '';
        detail.upcoming.forEach(item=>{
          const li = document.createElement('li');
          const time = document.createElement('time');
          time.textContent = item.date;
          const txt = document.createElement('div');
          txt.textContent = item.text;
          li.appendChild(time);
          li.appendChild(txt);
          todoList.appendChild(li);
        });
      }
    }

    function selectParcMachine(code){
      if(!code) return;
      document.querySelectorAll('.machine-tile').forEach(btn=>{
        btn.classList.toggle('active', btn.getAttribute('data-code')===code);
      });
      document.querySelectorAll('#tblParc tr').forEach(tr=>{
        tr.classList.toggle('selected', tr.getAttribute('data-code')===code);
      });
      updateParcDetail(code);
    }

    function setupParcInteractions(){
      updateParcCounters();
      const directory = document.getElementById('machineDirectory');
      if(directory){
        directory.querySelectorAll('.machine-tile').forEach(btn=>{
          btn.addEventListener('click', ()=>selectParcMachine(btn.getAttribute('data-code')));
        });
      }
      document.querySelectorAll('#tblParc tr').forEach(tr=>{
        tr.addEventListener('click', ()=>selectParcMachine(tr.getAttribute('data-code')));
        tr.addEventListener('keydown', evt=>{
          if(evt.key==='Enter' || evt.key===' '){
            evt.preventDefault();
            selectParcMachine(tr.getAttribute('data-code'));
          }
        });
      });
      const firstActive = directory?.querySelector('.machine-tile')?.getAttribute('data-code')
        || document.querySelector('#tblParc tr')?.getAttribute('data-code');
      if(firstActive) selectParcMachine(firstActive);
    }

    function renderLabels(filter){
      const data = [
        {code:'EQ-001', ref:'PI-0001', text:'DMU 70 ‚Äì Broche'},
        {code:'EQ-014', ref:'PI-0040', text:'Tornos ‚Äì Hydraulique'},
        {code:'EQ-022', ref:'PI-0099', text:'KAESER ‚Äì Filtration'}
      ];
      const root = document.getElementById('labels');
      root.innerHTML='';
      data.filter(d=>!filter || JSON.stringify(d).toLowerCase().includes(filter.toLowerCase()))
          .forEach(d=>{
        const card = document.createElement('div');
        card.className='card';
        card.style.padding='12px';
        card.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
            <div>
              <div style="font-weight:800">${d.code}</div>
              <div style="font-size:12px;color:var(--ink-dim)">${d.text}</div>
            </div>
            <div style="background:white;color:black;padding:8px;border-radius:8px">
              <div style="font:12px/1 monospace">${d.ref}</div>
              <svg width="120" height="40" viewBox="0 0 120 40">
                <rect width="120" height="40" fill="#fff"/>
                <!-- faux code-barres -->
                ${Array.from({length:40}).map((_,i)=>`<rect x="${i*3}" y="5" width="1" height="30" fill="#000" opacity="${(i%3)/2}" />`).join('')}
              </svg>
            </div>
          </div>`;
        root.appendChild(card);
      });
    }

    function fakeExport(){
      const rows = [['OT','Machine','Priorit√©','Statut','Pr√©vu'], ...Array.from(document.querySelectorAll('#tblOT tr')).map(tr=>[...tr.cells].slice(0,5).map(td=>td.innerText.trim()))];
      const csv = rows.map(r=>r.join(';')).join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'export_ot.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    function exportParc(){
      const head = ['Code','Zone','Fabricant','Machine','Mod√®le','N¬∞ S√©rie','Ann√©e','Statut'];
      const rows = Array.from(document.querySelectorAll('#tblParc tr'))
        .map(tr=>Array.from(tr.cells).map(td=>td.innerText.trim()));
      const csv = [head, ...rows].map(r=>r.join(';')).join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'parc_machines.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    function init(){
      let savedTheme = null;
      try{ savedTheme = localStorage.getItem('gmao-theme'); }catch(_e){ savedTheme = null; }
      applyTheme(savedTheme || 'dark', {persist:false});

      document.querySelectorAll('.modal').forEach(modal=>{
        modal.addEventListener('click', evt=>{
          if(evt.target === modal) closeModal(modal.id);
        });
      });

      document.addEventListener('keydown', evt=>{
        if(evt.key === 'Escape' && activeModal){
          evt.preventDefault();
          closeActiveModal();
        }else if(evt.key === 'Tab' && activeModal){
          const focusable = Array.from(activeModal.querySelectorAll(FOCUSABLE_SELECTOR)).filter(el=>!el.hasAttribute('disabled') && !el.getAttribute('aria-hidden'));
          if(!focusable.length) return;
          const first = focusable[0];
          const last = focusable[focusable.length-1];
          const active = document.activeElement;
          if(evt.shiftKey && active === first){
            evt.preventDefault();
            last.focus();
          }else if(!evt.shiftKey && active === last){
            evt.preventDefault();
            first.focus();
          }
        }
      });

      setupParcInteractions();
      renderLabels('');
    }

    if(document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', init);
    }else{
      init();
    }
  </script>
</body>
</html>

