<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prototype GMAO – Modèle HTML</title>
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --muted:#1f2937;       /* gray-800 */
      --card:#0b1220;        /* dark card */
      --ink:#e5e7eb;         /* gray-200 */
      --ink-dim:#9ca3af;     /* gray-400 */
      --brand:#22d3ee;       /* cyan-400 */
      --accent:#a78bfa;      /* violet-400 */
      --ok:#10b981;          /* emerald */
      --warn:#f59e0b;        /* amber */
      --bad:#ef4444;         /* red */
      --shadow:0 10px 25px rgba(0,0,0,.25), 0 1px 0 rgba(255,255,255,.03) inset;
      --radius:16px;
    }
    :root[data-theme="light"]{
      --bg:#f1f5f9;
      --panel:#ffffff;
      --muted:#e2e8f0;
      --card:#f8fafc;
      --ink:#0f172a;
      --ink-dim:#475569;
      --brand:#0ea5e9;
      --accent:#6366f1;
      --ok:#059669;
      --warn:#d97706;
      --bad:#dc2626;
      --shadow:0 12px 28px rgba(15,23,42,.12), 0 1px 0 rgba(15,23,42,.04) inset;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 600px at 80% -10%,rgba(167,139,250,.15),transparent),
                          radial-gradient(900px 500px at -20% 10%,rgba(34,211,238,.12),transparent),
                          var(--bg);color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";}
    :root[data-theme="light"] body{background:radial-gradient(1200px 600px at 80% -10%,rgba(99,102,241,.14),transparent),
                                   radial-gradient(900px 500px at -20% 10%,rgba(14,165,233,.12),transparent),
                                   var(--bg);}
    a{color:inherit;text-decoration:none}
    a:focus-visible,button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible{
      outline:2px solid var(--accent);
      outline-offset:2px;
    }
    .app{display:grid;grid-template-columns:260px 1fr;grid-template-rows:64px 1fr;height:100vh;gap:16px;padding:16px}
    header{grid-column:1/3;height:64px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);backdrop-filter:blur(6px);border-radius:var(--radius);display:flex;align-items:center;justify-content:space-between;padding:0 16px;box-shadow:var(--shadow)}
    :root[data-theme="light"] header,
    :root[data-theme="light"] nav,
    :root[data-theme="light"] main{background:linear-gradient(180deg,rgba(15,23,42,.05),rgba(15,23,42,.02));border:1px solid rgba(15,23,42,.08);}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--accent));display:grid;place-items:center;box-shadow:0 6px 20px rgba(34,211,238,.3)}
    .logo svg{filter:drop-shadow(0 2px 6px rgba(0,0,0,.3))}
    .brand h1{font-size:16px;letter-spacing:.3px;margin:0;font-weight:700}
    .header-actions{display:flex;gap:8px;align-items:center}
    .btn{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:12px;color:var(--ink);display:inline-flex;gap:8px;align-items:center;cursor:pointer;box-shadow:var(--shadow)}
    .btn.primary{background:linear-gradient(180deg,rgba(34,211,238,.25),rgba(34,211,238,.08));border-color:rgba(34,211,238,.3)}
    :root[data-theme="light"] .btn{background:linear-gradient(180deg,rgba(148,163,184,.12),rgba(148,163,184,.05));border:1px solid rgba(148,163,184,.26)}
    :root[data-theme="light"] .btn.primary{background:linear-gradient(180deg,rgba(14,165,233,.22),rgba(14,165,233,.08));border-color:rgba(14,165,233,.3)}
    .btn:active{transform:translateY(1px)}

    nav{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);padding:12px;box-shadow:var(--shadow)}
    .search{display:flex;gap:8px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px}
    :root[data-theme="light"] .search{background:rgba(148,163,184,.12);border:1px solid rgba(148,163,184,.28)}
    .search input{flex:1;background:transparent;border:0;outline:0;color:var(--ink)}
    .menu{margin-top:12px;display:flex;flex-direction:column;gap:6px;}
    .menu a{padding:10px 12px;border-radius:10px;border:1px solid transparent;display:flex;gap:10px;align-items:center}
    .menu a.active, .menu a:hover{background:rgba(167,139,250,.1);border-color:rgba(167,139,250,.25)}

    main{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);overflow:auto}
    .section{display:none;}
    .section.active{display:block}

    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
    :root[data-theme="light"] .card{border:1px solid rgba(15,23,42,.08)}
    .card h3{margin:0 0 6px 0;font-size:12px;color:var(--ink-dim);font-weight:600;letter-spacing:.3px;text-transform:uppercase}
    .card .value{font-size:24px;font-weight:800}
    .tag{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.12)}
    .tag.ok{background:rgba(16,185,129,.15);border-color:rgba(16,185,129,.35)}
    .tag.warn{background:rgba(245,158,11,.15);border-color:rgba(245,158,11,.35)}
    .tag.bad{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.35)}

    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{padding:10px}
    thead th{text-align:left;font-size:12px;color:var(--ink-dim);text-transform:uppercase;letter-spacing:.4px}
    tbody tr{background:var(--panel);border:1px solid rgba(255,255,255,.06)}
    :root[data-theme="light"] tbody tr{border:1px solid rgba(15,23,42,.08)}
    tbody tr td:first-child{border-radius:12px 0 0 12px}
    tbody tr td:last-child{border-radius:0 12px 12px 0}
    .status{font-weight:700}
    .status.ok{color:var(--ok)}
    .status.warn{color:var(--warn)}
    .status.bad{color:var(--bad)}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:12px 0}
    .toolbar .input, .toolbar select{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:8px 10px;color:var(--ink)}
    :root[data-theme="light"] .toolbar .input,
    :root[data-theme="light"] .toolbar select{background:rgba(148,163,184,.12);border:1px solid rgba(148,163,184,.28)}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);padding:24px}
    .modal.open{display:flex}
    .modal .sheet{width:min(720px,100%);background:var(--panel);border:1px solid rgba(255,255,255,.1);border-radius:18px;box-shadow:var(--shadow)}
    :root[data-theme="light"] .modal .sheet{border:1px solid rgba(15,23,42,.12)}
    .modal header{grid-column:auto;background:transparent;border:0;box-shadow:none;padding:16px}
    .modal .content{padding:16px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:12px;color:var(--ink-dim)}
    .field input,.field select,.field textarea{background:rgba(15,23,42,.6);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:8px 10px;color:var(--ink)}
    .field select option{background:var(--panel);color:var(--ink)}
    :root[data-theme="light"] .field input,
    :root[data-theme="light"] .field select,
    :root[data-theme="light"] .field textarea{background:rgba(226,232,240,.6);border:1px solid rgba(148,163,184,.4)}
    :root[data-theme="light"] .field select option{background:rgba(226,232,240,.95);color:var(--ink)}
    .actions{display:flex;gap:8px;justify-content:flex-end;padding:0 16px 16px}

    /* chips */
    .chip{border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);padding:6px 10px;border-radius:999px;font-size:12px}
    :root[data-theme="light"] .chip{border:1px solid rgba(148,163,184,.4);background:rgba(226,232,240,.6)}

    /* Bloc sites du tableau de bord */
    .sites-card{margin-bottom:16px}
    .site-panels{display:flex;gap:16px;flex-wrap:wrap;align-items:stretch}
    .site-panel{flex:1 1 320px;background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:18px;min-width:280px}
    :root[data-theme="light"] .site-panel{border:1px solid rgba(15,23,42,.08)}
    .site-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .site-title{font-size:16px;font-weight:700;letter-spacing:.4px;text-transform:uppercase}
    .site-badge{padding:4px 10px;border-radius:999px;background:rgba(167,139,250,.12);border:1px solid rgba(167,139,250,.28);font-size:12px}
    .site-section{display:flex;flex-direction:column;gap:12px}
    .site-section h4{margin:0;font-size:12px;color:var(--ink-dim);letter-spacing:.3px;text-transform:uppercase}
    .availability-summary{display:flex;align-items:center;gap:18px;flex-wrap:wrap}
    .availability-value{font-size:42px;font-weight:800;line-height:1}
    .availability-meta{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--ink-dim)}
    .trend-up{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;background:rgba(16,185,129,.15);color:var(--ok);font-size:14px;font-weight:700}
    .legend-list{list-style:none;margin:0;padding:0;display:grid;gap:10px}
    .legend-list li{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:8px 12px;gap:12px}
    :root[data-theme="light"] .legend-list li{border:1px solid rgba(148,163,184,.18);background:rgba(148,163,184,.08)}
    .legend-item{display:flex;align-items:center;gap:10px;font-weight:600}
    .legend-count{font-variant-numeric:tabular-nums;font-weight:600}
    .dot{width:12px;height:12px;border-radius:50%;display:inline-block}
    .dot.ok{background:var(--ok)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:var(--bad)}
    .dot.info{background:var(--brand)}
    .dot.attn{background:#facc15}

    @media (max-width:1100px){
      .app{grid-template-columns:1fr;grid-template-rows:auto 1fr}
      nav{order:2}
      main{order:3}
      header{order:1}
      .kpis{grid-template-columns:repeat(2,1fr)}
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2l3 6 6 .75-4.5 4 1.2 6.25L12 16.5 6.3 19l1.2-6.25L3 8.75 9 8l3-6z" stroke="#0b1020" stroke-width="1.2" fill="white" opacity=".9"/>
          </svg>
        </div>
        <h1>GMAO STSI / GILLET</h1>
      </div>
      <div class="header-actions">
        <button class="btn" id="themeToggle" type="button" onclick="toggleTheme()" title="Basculer le thème" aria-pressed="false">🌙 Mode sombre</button>
        <button class="btn primary" onclick="openModal('diModal')">➕ Demande d’intervention</button>
        <button class="btn primary" onclick="openModal('otModal')">➕ Nouvel OT</button>
      </div>
    </header>

    <nav>
      <div class="search" role="search">
        <span>🔎</span>
        <input id="globalSearch" placeholder="Rechercher… (machines, OT, pièces, fournisseurs)" oninput="globalFilter(this.value)">
      </div>
      <div class="menu" role="navigation">
        <a href="#" class="active" data-target="dashboard" onclick="switchSection(event)">📊 Tableau de bord</a>
        <a href="#" data-target="parc" onclick="switchSection(event)">🏭 Parc machines</a>
        <a href="#" data-target="interventions" onclick="switchSection(event)">🛠️ Interventions</a>
        <a href="#" data-target="preventif" onclick="switchSection(event)">⏱️ Préventif</a>
        <a href="#" data-target="stock" onclick="switchSection(event)">📦 Stock & pièces</a>
        <a href="#" data-target="commandes" onclick="switchSection(event)">🧾 Commandes</a>
        <a href="#" data-target="contacts" onclick="switchSection(event)">📇 Contacts</a>
        <a href="#" data-target="etiquettes" onclick="switchSection(event)">🏷️ Étiquettes / QR</a>
      </div>
    </nav>

    <main>
      <!-- Dashboard -->
      <section id="dashboard" class="section active" aria-label="Tableau de bord">
        <!-- Encart sites -->
        <div class="card sites-card">
          <h3>Sites suivis</h3>
          <div class="site-panels">
            <article class="site-panel">
              <div class="site-header">
                <span class="site-title">Site A</span>
                <span class="site-badge">Zone Nord</span>
              </div>
              <div class="site-section">
                <h4>Taux de Disponibilité</h4>
                <div class="availability-summary">
                  <span class="availability-value">50%</span>
                  <div class="availability-meta">
                    <span class="trend-up" aria-hidden="true">▲</span>
                    <span>2 machine(s) à l’arrêt</span>
                  </div>
                </div>
              </div>
              <div class="site-section">
                <h4>Répartition des Demandes d’intervention</h4>
                <ul class="legend-list" aria-label="Répartition des demandes">
                  <li>
                    <div class="legend-item"><span class="dot bad"></span><span>Attente</span></div>
                    <span class="legend-count">6</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot info"></span><span>En cours</span></div>
                    <span class="legend-count">9</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot ok"></span><span>Terminé</span></div>
                    <span class="legend-count">21</span>
                  </li>
                </ul>
              </div>
              <div class="site-section">
                <h4>État des Équipements</h4>
                <ul class="legend-list" aria-label="État des équipements">
                  <li>
                    <div class="legend-item"><span class="dot ok"></span><span>Opérationnelles</span></div>
                    <span class="legend-count">32</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot warn"></span><span>En maintenance</span></div>
                    <span class="legend-count">5</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot bad"></span><span>À l’arrêt</span></div>
                    <span class="legend-count">2</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot attn"></span><span>Préventifs à réaliser</span></div>
                    <span class="legend-count">7</span>
                  </li>
                </ul>
              </div>
            </article>
            <article class="site-panel">
              <div class="site-header">
                <span class="site-title">Site B</span>
                <span class="site-badge">Zone Sud</span>
              </div>
              <div class="site-section">
                <h4>Taux de Disponibilité</h4>
                <div class="availability-summary">
                  <span class="availability-value">78%</span>
                  <div class="availability-meta">
                    <span class="trend-up" aria-hidden="true">▲</span>
                    <span>1 machine(s) à l’arrêt</span>
                  </div>
                </div>
              </div>
              <div class="site-section">
                <h4>Répartition des Demandes d’intervention</h4>
                <ul class="legend-list" aria-label="Répartition des demandes">
                  <li>
                    <div class="legend-item"><span class="dot bad"></span><span>Attente</span></div>
                    <span class="legend-count">3</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot info"></span><span>En cours</span></div>
                    <span class="legend-count">4</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot ok"></span><span>Terminé</span></div>
                    <span class="legend-count">15</span>
                  </li>
                </ul>
              </div>
              <div class="site-section">
                <h4>État des Équipements</h4>
                <ul class="legend-list" aria-label="État des équipements">
                  <li>
                    <div class="legend-item"><span class="dot ok"></span><span>Opérationnelles</span></div>
                    <span class="legend-count">18</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot warn"></span><span>En maintenance</span></div>
                    <span class="legend-count">3</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot bad"></span><span>À l’arrêt</span></div>
                    <span class="legend-count">1</span>
                  </li>
                  <li>
                    <div class="legend-item"><span class="dot attn"></span><span>Préventifs à réaliser</span></div>
                    <span class="legend-count">2</span>
                  </li>
                </ul>
              </div>
            </article>
          </div>
        </div>

        <div class="kpis">
          <div class="card"><h3>OT Ouverts</h3><div class="value">18</div><span class="tag warn">+3 cette semaine</span></div>
          <div class="card"><h3>Taux préventif réalisé</h3><div class="value">86%</div><span class="tag ok">Objectif ≥ 80%</span></div>
          <div class="card"><h3>MTTR (médian)</h3><div class="value">2h35</div><span class="tag">Derniers 30 jours</span></div>
          <div class="card"><h3>Coût pièces (mois)</h3><div class="value">3 420 €</div><span class="tag bad">Budget +12%</span></div>
        </div>

        <div class="card">
          <h3>Backlog par priorité</h3>
          <div class="toolbar">
            <span class="chip">P1: 4</span>
            <span class="chip">P2: 9</span>
            <span class="chip">P3: 5</span>
            <button class="btn" onclick="openModal('reportModal')">📈 Export rapide</button>
          </div>
          <table aria-label="Backlog OT">
            <thead><tr><th>OT</th><th>Machine</th><th>Type</th><th>Priorité</th><th>Statut</th><th>Prévu</th></tr></thead>
            <tbody id="tblBacklog">
              <tr><td>OT-1024</td><td>DMU 70</td><td>Correctif</td><td>P1</td><td><span class="status warn">En cours</span></td><td>24/09/2025</td></tr>
              <tr><td>OT-1025</td><td>Tornos Deco</td><td>Qualité</td><td>P2</td><td><span class="status ok">Planifié</span></td><td>26/09/2025</td></tr>
              <tr><td>OT-1026</td><td>Compresseur KAESER</td><td>Sécurité</td><td>P1</td><td><span class="status bad">En retard</span></td><td>22/09/2025</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Parc -->
      <section id="parc" class="section" aria-label="Parc machines">
        <div class="toolbar">
          <input class="input" placeholder="Filtrer par zone…" oninput="filterTable('tblParc', this.value, [1])">
          <select onchange="filterStatus('tblParc', this.value)">
            <option value="">Tous statuts</option>
            <option value="ok">OK</option>
            <option value="warn">Surveillance</option>
            <option value="bad">Critique</option>
          </select>
          <button class="btn" onclick="openModal('equipModal')">➕ Ajouter équipement</button>
        </div>
        <table aria-label="Parc">
          <thead><tr><th>Code</th><th>Zone</th><th>Machine</th><th>Sous-ensemble</th><th>Criticité</th><th>Statut</th></tr></thead>
          <tbody id="tblParc">
            <tr data-status="ok"><td>EQ-001</td><td>Fraisage</td><td>DMU 70</td><td>Broche</td><td>Moyenne</td><td><span class="status ok">OK</span></td></tr>
            <tr data-status="warn"><td>EQ-014</td><td>Tournage</td><td>Tornos Deco</td><td>Hydraulique</td><td>Haute</td><td><span class="status warn">Surveillance</span></td></tr>
            <tr data-status="bad"><td>EQ-022</td><td>Utilities</td><td>Compresseur KAESER</td><td>Filtration</td><td>Haute</td><td><span class="status bad">Critique</span></td></tr>
          </tbody>
        </table>
      </section>

      <!-- Interventions -->
      <section id="interventions" class="section" aria-label="Interventions">
        <div class="toolbar">
          <select id="selType" class="input" onchange="filterTable('tblOT', this.value, [2])">
            <option value="">Type: Tous</option>
            <option>Correctif</option>
            <option>Palliatif</option>
            <option>Qualité</option>
            <option>Sécurité</option>
          </select>
          <select id="selPrio" class="input" onchange="filterTable('tblOT', this.value, [3])">
            <option value="">Priorité: Toutes</option>
            <option>P1</option>
            <option>P2</option>
            <option>P3</option>
          </select>
          <input class="input" placeholder="Rechercher travaux…" oninput="filterTable('tblOT', this.value, [5])">
          <button class="btn" onclick="openModal('otModal')">➕ Nouvel OT</button>
        </div>
        <table aria-label="Interventions">
          <thead><tr><th>OT</th><th>Machine</th><th>Type</th><th>Priorité</th><th>Statut</th><th>Travaux</th><th>Prévu</th></tr></thead>
          <tbody id="tblOT">
            <tr><td>OT-1024</td><td>DMU 70</td><td>Correctif</td><td>P1</td><td><span class="status warn">En cours</span></td><td>Vibrations broche</td><td>24/09/2025</td></tr>
            <tr><td>OT-1025</td><td>Tornos Deco</td><td>Qualité</td><td>P2</td><td><span class="status ok">Planifié</span></td><td>Contrôle géométrie</td><td>26/09/2025</td></tr>
            <tr><td>OT-1026</td><td>Compresseur KAESER</td><td>Sécurité</td><td>P1</td><td><span class="status bad">En retard</span></td><td>Remplacer cartouche</td><td>22/09/2025</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Préventif -->
      <section id="preventif" class="section" aria-label="Préventif">
        <div class="toolbar">
          <select class="input" onchange="filterTable('tblPrev', this.value, [2])">
            <option value="">Périodicité</option>
            <option>Hebdo</option>
            <option>Mensuel</option>
            <option>Trimestriel</option>
          </select>
          <button class="btn" onclick="openModal('planModal')">⚙️ Générer OT préventifs</button>
        </div>
        <table aria-label="Plan préventif">
          <thead><tr><th>Plan</th><th>Machine</th><th>Périodicité</th><th>Dernier</th><th>Prochain</th><th>État</th></tr></thead>
        <tbody id="tblPrev">
          <tr><td>PV-001</td><td>DMU 70</td><td>Mensuel</td><td>28/08/2025</td><td>28/09/2025</td><td><span class="status ok">À l'heure</span></td></tr>
          <tr><td>PV-017</td><td>Tornos Deco</td><td>Hebdo</td><td>18/09/2025</td><td>25/09/2025</td><td><span class="status warn">À lancer</span></td></tr>
          <tr><td>PV-023</td><td>Compresseur KAESER</td><td>Trimestriel</td><td>10/07/2025</td><td>10/10/2025</td><td><span class="status ok">OK</span></td></tr>
        </tbody>
        </table>
      </section>

      <!-- Stock -->
      <section id="stock" class="section" aria-label="Stock & pièces">
        <div class="toolbar">
          <input class="input" placeholder="Rechercher une pièce…" oninput="filterTable('tblStock', this.value, [1,2,3])">
          <select class="input" onchange="filterStockAlerte(this.value)">
            <option value="">Alerte stock</option>
            <option value="seuil">Sous seuil</option>
            <option value="ok">OK</option>
          </select>
          <button class="btn" onclick="openModal('pieceModal')">➕ Nouvelle pièce</button>
        </div>
        <table aria-label="Stock">
          <thead><tr><th>Réf interne</th><th>Désignation</th><th>Code</th><th>Emplacement</th><th>Qté</th><th>Seuil</th><th>Coût (€)</th></tr></thead>
          <tbody id="tblStock">
            <tr data-qty="3" data-seuil="5"><td>PI-0001</td><td>Cartouche filtre</td><td>CF-45</td><td>Mag A1</td><td>3</td><td>5</td><td>48.50</td></tr>
            <tr data-qty="22" data-seuil="10"><td>PI-0040</td><td>Courroie HTD</td><td>HTD-560</td><td>Mag C3</td><td>22</td><td>10</td><td>12.20</td></tr>
            <tr data-qty="6" data-seuil="6"><td>PI-0099</td><td>Graisse SKF</td><td>SKF-G1</td><td>Atelier</td><td>6</td><td>6</td><td>9.80</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Commandes -->
      <section id="commandes" class="section" aria-label="Commandes">
        <div class="toolbar">
          <select class="input" onchange="filterTable('tblCmd', this.value, [5])">
            <option value="">Statut</option>
            <option>Demandée</option>
            <option>Commandée</option>
            <option>Réceptionnée</option>
          </select>
          <button class="btn" onclick="openModal('cmdModal')">➕ Nouvelle commande</button>
        </div>
        <table aria-label="Commandes">
          <thead><tr><th>N°</th><th>Réf interne</th><th>Code</th><th>Désignation</th><th>Fournisseur</th><th>Statut</th><th>Montant (€)</th></tr></thead>
          <tbody id="tblCmd">
            <tr><td>CMD-2309-01</td><td>PI-0001</td><td>CF-45</td><td>Cartouche filtre</td><td>AirTech</td><td>Commandée</td><td>145.50</td></tr>
            <tr><td>CMP-2309-15</td><td>PI-0040</td><td>HTD-560</td><td>Courroie HTD</td><td>MecaPro</td><td>Demandée</td><td>85.00</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Contacts -->
      <section id="contacts" class="section" aria-label="Contacts">
        <div class="toolbar">
          <input class="input" placeholder="Rechercher fournisseur/intervenant…" oninput="filterTable('tblContacts', this.value, [0,1,2,3])">
          <button class="btn" onclick="openModal('contactModal')">➕ Nouveau contact</button>
        </div>
        <table aria-label="Contacts">
          <thead><tr><th>Entreprise</th><th>Activité</th><th>Contact</th><th>Email</th><th>Téléphone</th></tr></thead>
          <tbody id="tblContacts">
            <tr><td>AirTech</td><td>Compresseurs</td><td>J. Martin</td><td>service@airtech.tld</td><td>+33 4 12 34 56 78</td></tr>
            <tr><td>MecaPro</td><td>Fourniture Mécanique</td><td>S. Leroy</td><td>contact@mecapro.tld</td><td>+33 1 98 76 54 32</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Étiquettes -->
      <section id="etiquettes" class="section" aria-label="Étiquettes">
        <div class="toolbar">
          <input class="input" placeholder="Code / Réf…" oninput="renderLabels(this.value)">
          <button class="btn" onclick="window.print()">🖨️ Imprimer</button>
        </div>
        <div id="labels" class="grid"></div>
      </section>
    </main>
  </div>

  <!-- Modals -->
  <div class="modal" id="otModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Créer un OT">
    <div class="sheet">
      <header>
        <div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Nouvel ordre de travail</h1></div>
      </header>
      <div class="content">
        <div class="grid">
          <div class="field"><label>Machine</label><input placeholder="ex. DMU 70"/></div>
          <div class="field"><label>Type</label><select><option>Correctif</option><option>Palliatif</option><option>Qualité</option><option>Sécurité</option></select></div>
          <div class="field"><label>Priorité</label><select><option>P1</option><option>P2</option><option>P3</option></select></div>
          <div class="field"><label>Prévu le</label><input type="date"/></div>
          <div class="field" style="grid-column:1/-1"><label>Travaux à effectuer</label><textarea rows="3" placeholder="Décrire la demande…"></textarea></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" onclick="closeModal('otModal')">Annuler</button>
        <button class="btn primary" onclick="closeModal('otModal')">Créer</button>
      </div>
    </div>
  </div>

  <div class="modal" id="diModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Créer une demande d’intervention">
    <div class="sheet">
      <header>
        <div class="brand">
          <div class="logo" style="width:28px;height:28px"></div>
          <h1>Nouvelle demande d’intervention</h1>
        </div>
      </header>
      <div class="content">
        <div class="grid">
          <div class="field">
            <label>Date de la demande</label>
            <input type="date"/>
          </div>
          <div class="field">
            <label>Machine</label>
            <input type="text" placeholder="Nom de la machine…"/>
          </div>
          <div class="field">
            <label>Type</label>
            <select>
              <option value="correctif">Correctif</option>
              <option value="palliatif">Palliatif</option>
              <option value="qualite">Qualité</option>
              <option value="securite">Sécurité</option>
            </select>
          </div>
          <div class="field" style="grid-column:1/-1">
            <label>Priorité</label>
            <label><input type="radio" name="di-prio" value="P1" style="background:transparent;border:none;padding:0;vertical-align:middle;margin-right:4px;accent-color:var(--accent)"> P1 : Urgent (machine à l’arrêt)</label>
            <label><input type="radio" name="di-prio" value="P2" style="background:transparent;border:none;padding:0;vertical-align:middle;margin-right:4px;accent-color:var(--accent)"> P2 : Moyen (défaut sans interruption)</label>
            <label><input type="radio" name="di-prio" value="P3" style="background:transparent;border:none;padding:0;vertical-align:middle;margin-right:4px;accent-color:var(--accent)"> P3 : Faible</label>
          </div>
          <div class="field" style="grid-column:1/-1">
            <label><input type="checkbox" name="di-stop" style="background:transparent;border:none;padding:0;vertical-align:middle;margin-right:4px;accent-color:var(--accent)"> Machine à l’arrêt</label>
          </div>
          <div class="field" style="grid-column:1/-1">
            <label>Travaux à effectuer</label>
            <textarea rows="3" placeholder="Décrire les travaux demandés…"></textarea>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" onclick="closeModal('diModal')">Annuler</button>
        <button class="btn primary" onclick="closeModal('diModal')">Envoyer</button>
      </div>
    </div>
  </div>

  <div class="modal" id="equipModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Ajouter un équipement"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Ajouter équipement</h1></div></header><div class="content"><div class="grid"><div class="field"><label>Code</label><input></div><div class="field"><label>Zone</label><input></div><div class="field"><label>Machine</label><input></div><div class="field"><label>Sous-ensemble</label><input></div><div class="field"><label>Criticité</label><select><option>Basse</option><option>Moyenne</option><option>Haute</option></select></div></div></div><div class="actions"><button class="btn" onclick="closeModal('equipModal')">Fermer</button><button class="btn primary" onclick="closeModal('equipModal')">Enregistrer</button></div></div></div>
  <div class="modal" id="pieceModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Créer une pièce"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Nouvelle pièce</h1></div></header><div class="content"><div class="grid"><div class="field"><label>Réf interne</label><input></div><div class="field"><label>Désignation</label><input></div><div class="field"><label>Code</label><input></div><div class="field"><label>Emplacement</label><input></div><div class="field"><label>Seuil</label><input type="number"></div><div class="field"><label>Coût (€)</label><input type="number" step="0.01"></div></div></div><div class="actions"><button class="btn" onclick="closeModal('pieceModal')">Fermer</button><button class="btn primary" onclick="closeModal('pieceModal')">Enregistrer</button></div></div></div>
  <div class="modal" id="cmdModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Créer une commande"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Nouvelle commande</h1></div></header><div class="content"><div class="grid"><div class="field"><label>Fournisseur</label><input></div><div class="field"><label>Réf interne</label><input></div><div class="field"><label>Code</label><input></div><div class="field"><label>Statut</label><select><option>Demandée</option><option>Commandée</option><option>Réceptionnée</option></select></div><div class="field"><label>Montant (€)</label><input type="number" step="0.01"></div></div></div><div class="actions"><button class="btn" onclick="closeModal('cmdModal')">Fermer</button><button class="btn primary" onclick="closeModal('cmdModal')">Enregistrer</button></div></div></div>
  <div class="modal" id="contactModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Créer un contact"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Nouveau contact</h1></div></header><div class="content"><div class="grid"><div class="field"><label>Entreprise</label><input></div><div class="field"><label>Activité</label><input></div><div class="field"><label>Contact</label><input></div><div class="field"><label>Email</label><input type="email"></div><div class="field"><label>Téléphone</label><input></div></div></div><div class="actions"><button class="btn" onclick="closeModal('contactModal')">Fermer</button><button class="btn primary" onclick="closeModal('contactModal')">Enregistrer</button></div></div></div>
  <div class="modal" id="planModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Générer des OT préventifs"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Générer OT préventifs</h1></div></header><div class="content"><p>Sélectionner l'horizon de planification et la périodicité.</p><div class="grid"><div class="field"><label>Horizon (jours)</label><input type="number" value="30"></div><div class="field"><label>Inclure retard</label><select><option>Oui</option><option>Non</option></select></div></div></div><div class="actions"><button class="btn" onclick="closeModal('planModal')">Fermer</button><button class="btn primary" onclick="closeModal('planModal')">Générer</button></div></div></div>
  <div class="modal" id="reportModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Exporter les données"><div class="sheet"><header><div class="brand"><div class="logo" style="width:28px;height:28px"></div><h1>Export rapide</h1></div></header><div class="content"><p>Ce prototype exportera un CSV fictif. À connecter à votre backend plus tard.</p></div><div class="actions"><button class="btn" onclick="closeModal('reportModal')">Fermer</button><button class="btn primary" onclick="fakeExport()">Exporter CSV</button></div></div></div>

  <script>
    const THEMES = {
      dark:{
        '--bg':'#0f172a',
        '--panel':'#111827',
        '--muted':'#1f2937',
        '--card':'#0b1220',
        '--ink':'#e5e7eb',
        '--ink-dim':'#9ca3af',
        '--brand':'#22d3ee',
        '--accent':'#a78bfa',
        '--ok':'#10b981',
        '--warn':'#f59e0b',
        '--bad':'#ef4444',
        '--shadow':'0 10px 25px rgba(0,0,0,.25), 0 1px 0 rgba(255,255,255,.03) inset'
      },
      light:{
        '--bg':'#f1f5f9',
        '--panel':'#ffffff',
        '--muted':'#e2e8f0',
        '--card':'#f8fafc',
        '--ink':'#0f172a',
        '--ink-dim':'#475569',
        '--brand':'#0ea5e9',
        '--accent':'#6366f1',
        '--ok':'#059669',
        '--warn':'#d97706',
        '--bad':'#dc2626',
        '--shadow':'0 12px 28px rgba(15,23,42,.12), 0 1px 0 rgba(15,23,42,.04) inset'
      }
    };
    const FOCUSABLE_SELECTOR = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
    let currentTheme = 'dark';
    let activeModal = null;
    let lastFocusedElement = null;

    function switchSection(e){
      e.preventDefault();
      const target = e.currentTarget.getAttribute('data-target');
      document.querySelectorAll('.menu a').forEach(a=>a.classList.toggle('active', a.getAttribute('data-target')===target));
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.getElementById(target).classList.add('active');
    }

    function applyTheme(theme,{persist=true}={}){
      if(!THEMES[theme]) theme='dark';
      currentTheme = theme;
      const root = document.documentElement;
      root.dataset.theme = theme;
      const vars = THEMES[theme];
      Object.entries(vars).forEach(([key,val])=>root.style.setProperty(key,val));
      if(persist){
        try{ localStorage.setItem('gmao-theme', theme); }catch(_e){/* storage non critique */}
      }
      updateThemeToggle();
    }

    function updateThemeToggle(){
      const btn = document.getElementById('themeToggle');
      if(!btn) return;
      const isLight = currentTheme === 'light';
      btn.setAttribute('aria-pressed', isLight ? 'true' : 'false');
      btn.textContent = isLight ? '🌞 Mode clair' : '🌙 Mode sombre';
    }

    function toggleTheme(){
      const next = currentTheme === 'dark' ? 'light' : 'dark';
      applyTheme(next);
    }

    function openModal(id){
      const modal = document.getElementById(id);
      if(!modal) return;
      lastFocusedElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      activeModal = modal;
      document.body.style.overflow = 'hidden';
      const focusable = modal.querySelectorAll(FOCUSABLE_SELECTOR);
      if(focusable.length){
        focusable[0].focus({preventScroll:true});
      }
    }

    function closeModal(id){
      const modal = document.getElementById(id);
      if(!modal) return;
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
      if(activeModal === modal) activeModal = null;
      if(!document.querySelector('.modal.open')){
        document.body.style.overflow = '';
        if(lastFocusedElement && document.body.contains(lastFocusedElement)){
          lastFocusedElement.focus({preventScroll:true});
        }
        lastFocusedElement = null;
      }
    }

    function closeActiveModal(){
      if(activeModal){
        closeModal(activeModal.id);
      }
    }

    // Simple global filter across visible table bodies
    function globalFilter(q){
      q = (q||'').toLowerCase();
      document.querySelectorAll('tbody').forEach(tb=>{
        tb.querySelectorAll('tr').forEach(tr=>{
          const hit = tr.innerText.toLowerCase().includes(q);
          tr.style.display = hit ? '' : 'none';
        });
      });
    }

    function filterTable(tbodyId, q, cols){
      q = (q||'').toLowerCase();
      const rows = document.getElementById(tbodyId).rows;
      for(const tr of rows){
        if(!q){ tr.style.display=''; continue; }
        let hit=false;
        (cols||[...tr.cells].map((_,i)=>i)).forEach(i=>{
          const cell = tr.cells[i];
          if(cell && cell.innerText.toLowerCase().includes(q)) hit=true;
        });
        tr.style.display = hit?'':'none';
      }
    }

    function filterStatus(tbodyId, status){
      const rows = document.getElementById(tbodyId).rows;
      for(const tr of rows){
        const st = (tr.getAttribute('data-status')||'').toLowerCase();
        tr.style.display = !status || st===status ? '' : 'none';
      }
    }

    function filterStockAlerte(val){
      const rows = document.getElementById('tblStock').rows;
      for(const tr of rows){
        const q = parseFloat(tr.getAttribute('data-qty'));
        const s = parseFloat(tr.getAttribute('data-seuil'));
        const sousSeuil = q < s;
        if(!val) tr.style.display='';
        else if(val==='seuil') tr.style.display = sousSeuil ? '' : 'none';
        else if(val==='ok') tr.style.display = sousSeuil ? 'none' : '';
      }
    }

    function renderLabels(filter){
      const data = [
        {code:'EQ-001', ref:'PI-0001', text:'DMU 70 – Broche'},
        {code:'EQ-014', ref:'PI-0040', text:'Tornos – Hydraulique'},
        {code:'EQ-022', ref:'PI-0099', text:'KAESER – Filtration'}
      ];
      const root = document.getElementById('labels');
      root.innerHTML='';
      data.filter(d=>!filter || JSON.stringify(d).toLowerCase().includes(filter.toLowerCase()))
          .forEach(d=>{
        const card = document.createElement('div');
        card.className='card';
        card.style.padding='12px';
        card.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
            <div>
              <div style="font-weight:800">${d.code}</div>
              <div style="font-size:12px;color:var(--ink-dim)">${d.text}</div>
            </div>
            <div style="background:white;color:black;padding:8px;border-radius:8px">
              <div style="font:12px/1 monospace">${d.ref}</div>
              <svg width="120" height="40" viewBox="0 0 120 40">
                <rect width="120" height="40" fill="#fff"/>
                <!-- faux code-barres -->
                ${Array.from({length:40}).map((_,i)=>`<rect x="${i*3}" y="5" width="1" height="30" fill="#000" opacity="${(i%3)/2}" />`).join('')}
              </svg>
            </div>
          </div>`;
        root.appendChild(card);
      });
    }

    function fakeExport(){
      const rows = [['OT','Machine','Priorité','Statut','Prévu'], ...Array.from(document.querySelectorAll('#tblOT tr')).map(tr=>[...tr.cells].slice(0,5).map(td=>td.innerText.trim()))];
      const csv = rows.map(r=>r.join(';')).join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'export_ot.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    function init(){
      let savedTheme = null;
      try{ savedTheme = localStorage.getItem('gmao-theme'); }catch(_e){ savedTheme = null; }
      applyTheme(savedTheme || 'dark', {persist:false});

      document.querySelectorAll('.modal').forEach(modal=>{
        modal.addEventListener('click', evt=>{
          if(evt.target === modal) closeModal(modal.id);
        });
      });

      document.addEventListener('keydown', evt=>{
        if(evt.key === 'Escape' && activeModal){
          evt.preventDefault();
          closeActiveModal();
        }else if(evt.key === 'Tab' && activeModal){
          const focusable = Array.from(activeModal.querySelectorAll(FOCUSABLE_SELECTOR)).filter(el=>!el.hasAttribute('disabled') && !el.getAttribute('aria-hidden'));
          if(!focusable.length) return;
          const first = focusable[0];
          const last = focusable[focusable.length-1];
          const active = document.activeElement;
          if(evt.shiftKey && active === first){
            evt.preventDefault();
            last.focus();
          }else if(!evt.shiftKey && active === last){
            evt.preventDefault();
            first.focus();
          }
        }
      });

      renderLabels('');
    }

    if(document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', init);
    }else{
      init();
    }
  </script>
</body>
</html>

